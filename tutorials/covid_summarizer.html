

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>TO DO : &mdash; Structured and Interactive Summarization 0.2.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Structured and Interactive Summarization
          

          
          </a>

          
            
            
              <div class="version">
                0.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Structured and Interactive Summarization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Structured and Interactive Summarization</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>TO DO :</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/tutorials/covid_summarizer.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<p>COVID-19 summarizer</p>
<div class="section" id="TO-DO-:">
<h1>TO DO :<a class="headerlink" href="#TO-DO-:" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>Problem with visualizer : upper cases prevent the words to be colorised</p></li>
<li><p>biaising :</p></li>
<li><p>change size of generic query depending on the scores of words ? test the auto_k</p></li>
<li><p>SpaCy for lemmatization</p></li>
<li><p>data loader fileSource à mettre en place ici</p></li>
<li><p>réparer problème used_sentences</p></li>
</ul>
<div class="section" id="The-COVID-19-dataset">
<h2>The COVID-19 dataset<a class="headerlink" href="#The-COVID-19-dataset" title="Permalink to this headline">¶</a></h2>
</div>
</div>
<div class="section" id="Get-the-dataset">
<h1>Get the dataset<a class="headerlink" href="#Get-the-dataset" title="Permalink to this headline">¶</a></h1>
<p>The dataset can be downloaded from <a class="reference external" href="https://www.kaggle.com/allen-institute-for-ai/CORD-19-research-challenge">Kaggle website</a> by clicking the Download (4 GB) button once registered. You’ll get a zip of ~750Mo.</p>
<p>Please define the absolute path of the uncompressed archive to run the rest of the notebook:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">DATASET_DIR</span> <span class="o">=</span> <span class="s2">&quot;/home/melanie/git/newdle/datasets/CORD19_research_challenge&quot;</span>
<span class="c1">#DATASET_DIR = &quot;/home/mando/git/gitolite/newdle/datasets/CORD19_research_challenge&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Load-the-dataset">
<h1>Load the dataset<a class="headerlink" href="#Load-the-dataset" title="Permalink to this headline">¶</a></h1>
<p>The following functions can be used to load the dataset and extract some attributes of the loaded documents. For abstract, we only keep the first element of the list exposed by Kaggle, as most of time the next elements are not abstract (e.g. keywords, copyright, etc.).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">summarizer.data_loader</span> <span class="kn">import</span> <span class="n">load_dataset</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">summarizer.tokenizer</span> <span class="kn">import</span> <span class="n">make_sentences</span><span class="p">,</span> <span class="n">words</span>

<span class="n">blabla</span> <span class="o">=</span> <span class="s2">&quot;decimal numbers like 0.50 and .com are they a problem ? Or Fig. or (Fig. 273) or ( Fig.3) ? Because i.e. shoudn&#39;t cut a sentence e.g. here. And if I talk abour M. Cambus or Dr. Who, will it cut ?&quot;</span>
<span class="n">sentences</span> <span class="o">=</span> <span class="n">make_sentences</span><span class="p">(</span><span class="n">blabla</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">sentences</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;decimal numbers like 0.50 and .com are they a problem ?&#39;,
 &#39;Or Fig. or (Fig. 273) or ( Fig.3) ?&#39;,
 &#34;Because i.e. shoudn&#39;t cut a sentence e.g. here.&#34;,
 &#39;And if I talk abour M. Cambus or Dr. Who, will it cut ?&#39;]
</pre></div></div>
</div>
<div class="section" id="Summarizing-using-Gismo">
<h2>Summarizing using Gismo<a class="headerlink" href="#Summarizing-using-Gismo" title="Permalink to this headline">¶</a></h2>
</div>
</div>
<div class="section" id="Installation-steps">
<h1>Installation steps<a class="headerlink" href="#Installation-steps" title="Permalink to this headline">¶</a></h1>
<p>We now try to design a simple summarizer by using Gismo, made by <a class="reference external" href="mailto:fabien&#46;mathieu&#37;&#52;&#48;nokia-bell-labs&#46;com">Fabien Mathieu</a>.</p>
<p>Gismo can be installed as follows: 1. If you don’t have yet a ssh key, create it.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo apt update
sudo apt install ssh
ssh-keygen -t rsa -b 2048
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>The previous command makes a public key <code class="docutils literal notranslate"><span class="pre">~/.ssh/id_rsa.pub</span></code> and a private key <code class="docutils literal notranslate"><span class="pre">~/.ssh/id_rsa</span></code>. The private key must always stay on your personal computer(s) and never be shared. Send by email your public ssh key <code class="docutils literal notranslate"><span class="pre">~/.ssh/id_rsa.pub</span></code> to <a class="reference external" href="mailto:fabien&#46;mathieu&#37;&#52;&#48;nokia-bell-labs&#46;com">Fabien Mathieu</a> or <a class="reference external" href="mailto:marc-olivier&#46;buob&#37;&#52;&#48;nokia-bell-labs&#46;com">Marc-Olivier Buob</a>.</p></li>
<li><p>Once you’ve access to the repository, run:</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>sudo apt install git
mkdir ~/git
cd ~/git
ssh-add
git clone gitolite3@git.lincs.fr:gismo.git
cd gismo
sudo python3 setup.py install
</pre></div>
</div>
</div>
<div class="section" id="Summarizing-a-corpus-of-documents">
<h1>Summarizing a corpus of documents<a class="headerlink" href="#Summarizing-a-corpus-of-documents" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><strong>Goal:</strong> Summarizing a corpus of documents by using Gismo.</p></li>
<li><p><strong>Inputs:</strong> The abstracts of the documents.</p></li>
<li><p><strong>Parameters:</strong></p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\alpha \in [0,1]\)</span> the D-iteration damping factor, which is a Gismo parameter. This indicates if we stay close to the document(s) matching the query or if we explore further.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">q</span></code> the string searched by the user, corresponding to the user query.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_documents</span></code> <span class="math notranslate nohighlight">\(\in \mathbb{N}^*\)</span> the number of top-documents used to build the summary.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">num_sentences</span></code> the number of sentences in the output summary.</p></li>
</ul>
</li>
<li><p><strong>Output:</strong> A string summarizing the whole corpus (using only abstracts at the moment).</p></li>
</ul>
<p>This summarizer works as follows: 1. Get the <code class="docutils literal notranslate"><span class="pre">num_documents</span></code>-top documents. Build the corresponding set of sentences. 2. Get the <code class="docutils literal notranslate"><span class="pre">num_sentences</span></code>-top sentences from this set. Thus, each sentences is mapped to a <code class="docutils literal notranslate"><span class="pre">document_ranking</span></code> and its local <code class="docutils literal notranslate"><span class="pre">sentence_ranking</span></code>. 3. Build the summary by contenating these best sentences and sort them according to the <code class="docutils literal notranslate"><span class="pre">(document_ranking,</span> <span class="pre">sentence_ranking)</span></code> lexical order.</p>
</div>
<div class="section" id="Experiments">
<h1>Experiments<a class="headerlink" href="#Experiments" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">NUM_DOCUMENTS</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">NUM_SENTENCES</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">summarizer.language_filtering</span>   <span class="kn">import</span> <span class="n">guess_language</span>
<span class="kn">from</span> <span class="nn">summarizer.simplified_documents</span> <span class="kn">import</span> <span class="n">get_abstract</span><span class="p">,</span> <span class="n">make_content_doc</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="n">RAW_DOCUMENTS</span> <span class="o">=</span> <span class="n">load_dataset</span><span class="p">(</span><span class="n">DATASET_DIR</span><span class="p">,</span> <span class="n">max_documents</span> <span class="o">=</span> <span class="n">NUM_DOCUMENTS</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">RAW_DOCUMENTS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="c1"># DOCUMENTS : with abstracts and in english only</span>

<span class="n">DOCUMENTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">document</span>
    <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">RAW_DOCUMENTS</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">document</span><span class="p">[</span><span class="s2">&quot;abstract&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> \
    <span class="c1">#and (document[&quot;lang&quot;] == &quot;en&quot;) \</span>
    <span class="c1">#and (guess_language(document[&quot;abstract&quot;]) == &quot;en&quot;)</span>
    <span class="ow">and</span> <span class="p">(</span><span class="n">document</span><span class="p">[</span><span class="s2">&quot;lang&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;en&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">DOCUMENTS</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;title&#39;, &#39;abstract&#39;, &#39;content&#39;, &#39;url&#39;, &#39;lang&#39;])
6740
</pre></div></div>
</div>
<p>When loading 100 documents, there are 36 documents left out : * 34 of them don’t have abstracts (the summaries of these precise documents cannot be evaluates, if summarizing the document’s abstracts these documents are not taken into account) * 2 documents are in spanish (one with a spanish content and the other just with a spanish abstract, has to be deleted because we take abstract as reference summaries)</p>
<p>getting a list of english stopwords to give it to the embedding when first initialized in order to rank documents with a general embedding.</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">spacy</span> <span class="pre">download</span> <span class="pre">en_core_web_sm</span></code> needs to be done before using spacy (using gensim and bert)</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="c1"># We use gensim stop words so the comparision with our summarizer makes sense</span>
<span class="kn">from</span> <span class="nn">gensim.parsing.preprocessing</span> <span class="kn">import</span> <span class="n">STOPWORDS</span>
<span class="n">EN_STOP_WORDS</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">STOPWORDS</span><span class="p">)</span> <span class="c1">#+ [&quot;words&quot;, &quot;summarized&quot;, &quot;focusing&quot;, &quot;simultaneously&quot;, &quot;decision&quot;,</span>
<span class="c1">#    &quot;sufficiently&quot;, &quot;feedback&quot;, &quot;optimum&quot;, &quot;approach&quot;, &quot;respondents&quot;, &quot;preferred&quot;, &quot;selecting&quot;,</span>
<span class="c1">#    &quot;formulations&quot;, &quot;empirically&quot;, &quot;existing&quot;, &quot;stock&quot;, &quot;returns&quot;, &quot;weeks&quot;, &quot;collected&quot;, &quot;paired&quot;,</span>
<span class="c1">#    &quot;evidenced&quot;, &quot;homogeneous&quot;, &quot;enped&quot;, &quot;terminated&quot;, &quot;repeated&quot;, &quot;recorded&quot;,</span>
<span class="c1">#    &quot;concentrated&quot;, &quot;left&quot;, &quot;day&quot;, &quot;end&quot;, &quot;items&quot;, &quot;obervation&quot;, &quot;obervations&quot;, &quot;field&quot;, &quot;multiplied&quot;,</span>
<span class="c1">#    &quot;faster&quot;, &quot;satisfactory&quot;,&quot;place&quot;, &quot;versus&quot;, &quot;information&quot;, &quot;minimize&quot;, &quot;proper&quot;, &quot;utilize&quot;, &quot;strongest&quot;,</span>
<span class="c1">#    &quot;utilize&quot;, &quot;self&quot;, &quot;susceptible&quot;, &quot;delay&quot;, &quot;suspicion&quot;, &quot;exceeded&quot;, &quot;delays&quot;, &quot;asked&quot;, &quot;strongly&quot;,</span>
<span class="c1">#    &quot;prevent&quot;, &quot;past&quot;, &quot;advice&quot;, &quot;waiting&quot;, &quot;aimed&quot;, &quot;utilization&quot;, &quot;knowing&quot;, &quot;process&quot;, &quot;served&quot;, &quot;accurate&quot;,</span>
<span class="c1">#    &quot;spite&quot;, &quot;introducing&quot;, &quot;rest&quot;, &quot;uniform&quot;, &quot;von&quot;, &quot;coordinating&quot;, &quot;supposed&quot;, &quot;deduced&quot;, &quot;rapid&quot;,</span>
<span class="c1">#    &quot;heightened&quot;, &quot;realistic&quot;, &quot;suspected&quot;, &quot;confirmation&quot;, &quot;traced&quot;, &quot;historically&quot;, &quot;remote&quot;, &quot;performs&quot;,</span>
<span class="c1">#    &quot;improves&quot;, &quot;normal&quot;, &quot;ratio&quot;, &quot;noted&quot;, &quot;declining&quot;, &quot;raised&quot;, &quot;vs&quot;, &quot;years&quot;, &quot;aged&quot;]</span>
<span class="n">pprint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">EN_STOP_WORDS</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
WARNING:smart_open.transport:unable to import &#39;smart_open.gcs&#39;, disabling that module
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
337
</pre></div></div>
</div>
<p>The list of stopwords might have to be ajusted</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#from summarizer.gismo_wrapper      import initialize_embedding, sanitize_text, simplified_document_to_string</span>
<span class="c1">#from summarizer.language_filtering import EN_STOP_WORDS</span>
<span class="c1">#</span>
<span class="c1">#print(DOCUMENTS[0].keys())</span>
<span class="c1">#</span>
<span class="c1">## Too long, needs to be changed</span>
<span class="c1">#CLEAN_DOCUMENTS = [</span>
<span class="c1">#    {</span>
<span class="c1">#        &quot;title&quot; : sanitize_text(document[&quot;title&quot;]),</span>
<span class="c1">#        &quot;abstract&quot; : sanitize_text(document[&quot;abstract&quot;]),</span>
<span class="c1">#        &quot;content&quot; : sanitize_text(document[&quot;content&quot;])</span>
<span class="c1">#    }</span>
<span class="c1">#    for document in DOCUMENTS</span>
<span class="c1">#]</span>
<span class="c1">#</span>
<span class="c1">#EMBEDDING = initialize_embedding(</span>
<span class="c1">#    documents = CLEAN_DOCUMENTS,</span>
<span class="c1">#    stop_words = EN_STOP_WORDS,</span>
<span class="c1">#    document_to_text = simplified_document_to_string,</span>
<span class="c1">#    min_df = 5</span>
<span class="c1">#)</span>
<span class="c1">##print(EMBEDDING.features)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">summarizer.gismo_wrapper</span>      <span class="kn">import</span> <span class="n">initialize_embedding</span><span class="p">,</span> <span class="n">sanitize_text</span><span class="p">,</span> <span class="n">simplified_document_to_string</span>
<span class="kn">from</span> <span class="nn">summarizer.language_filtering</span> <span class="kn">import</span> <span class="n">EN_STOP_WORDS</span>
<span class="kn">from</span> <span class="nn">gismo</span> <span class="kn">import</span> <span class="n">Embedding</span><span class="p">,</span> <span class="n">Corpus</span>

<span class="nb">print</span><span class="p">(</span><span class="n">DOCUMENTS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1"># Too long, needs to be changed</span>
<span class="n">CLEAN_DOCUMENTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;title&quot;</span> <span class="p">:</span> <span class="n">sanitize_text</span><span class="p">(</span><span class="n">document</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]),</span>
        <span class="s2">&quot;abstract&quot;</span> <span class="p">:</span> <span class="n">sanitize_text</span><span class="p">(</span><span class="n">document</span><span class="p">[</span><span class="s2">&quot;abstract&quot;</span><span class="p">]),</span>
        <span class="s2">&quot;content&quot;</span> <span class="p">:</span> <span class="n">sanitize_text</span><span class="p">(</span><span class="n">document</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">])</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">DOCUMENTS</span>
<span class="p">]</span>

<span class="kn">import</span> <span class="nn">spacy</span>
<span class="c1"># Initialize spacy &#39;en&#39; model, keeping only tagger component needed for lemmatization</span>
<span class="n">nlp_emb</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;en_core_web_sm&#39;</span><span class="p">,</span> <span class="n">disable</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;parser&#39;</span><span class="p">,</span> <span class="s1">&#39;ner&#39;</span><span class="p">])</span>
<span class="n">nlp_emb</span><span class="o">.</span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">2000000</span>
<span class="c1"># Who cares about DET and such?</span>
<span class="c1">#keep = {&#39;ADJ&#39;, &#39;NOUN&#39;, &#39;NUM&#39;, &#39;PROPN&#39;, &#39;SYM&#39;, &#39;VERB&#39;}</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">txt</span><span class="p">:</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">token</span><span class="o">.</span><span class="n">lemma_</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>\
                                   <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">nlp_emb</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span><span class="o">.</span><span class="n">is_stop</span><span class="p">])</span>
                                     <span class="c1">#if token.pos_ in keep and not token.is_stop])</span>


<span class="kn">import</span> <span class="nn">time</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>

<span class="c1">#EMBEDDING = Embedding(filename=&quot;embedding_covid_lemmas&quot;, path=&quot;&quot;)</span>
<span class="n">EMBEDDING</span> <span class="o">=</span> <span class="n">initialize_embedding</span><span class="p">(</span>
    <span class="n">CLEAN_DOCUMENTS</span><span class="p">,</span>
    <span class="n">EN_STOP_WORDS</span><span class="p">,</span>
    <span class="n">document_to_text</span> <span class="o">=</span> <span class="n">simplified_document_to_string</span><span class="p">,</span>
    <span class="n">min_df</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="c1">#preprocessor = preprocessor</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span><span class="o">-</span><span class="n">start_time</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
dict_keys([&#39;title&#39;, &#39;abstract&#39;, &#39;content&#39;, &#39;url&#39;, &#39;lang&#39;])
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/melanie/.local/lib/python3.6/site-packages/spacy/util.py:275: UserWarning: [W031] Model &#39;en_core_web_sm&#39; (2.2.5) requires spaCy v2.2 and is incompatible with the current spaCy version (2.3.2). This may lead to unexpected results or runtime errors. To resolve this, download a newer compatible model or retrain your custom model with the current spaCy version. For more details and available updates, run: python -m spacy validate
  warnings.warn(warn_msg)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
12.704887000000003
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#import tempfile</span>
<span class="c1">#</span>
<span class="c1">#with tempfile.TemporaryDirectory() as tmpdirname:</span>
<span class="c1">#    EMBEDDING.save(filename=&quot;embedding_covid_lemmas&quot;, path=&quot;&quot;)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">VOCABULARY</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">EMBEDDING</span><span class="o">.</span><span class="n">features</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">VOCABULARY</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
44932
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">remove_duplicates</span><span class="p">(</span><span class="n">data</span> <span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="n">unique_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
            <span class="n">unique_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unique_data</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#from summarizer.building_summary import summarize</span>

<span class="o">%</span><span class="k">run</span> ./idf_embedding.ipynb

<span class="kn">import</span> <span class="nn">spacy</span>
<span class="kn">import</span> <span class="nn">neuralcoref</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="n">nlp</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;en_core_web_sm&quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">neuralcoref</span><span class="o">.</span><span class="n">add_to_pipe</span><span class="p">(</span><span class="n">nlp</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;neuralcoref already in spacy pipeline&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">gismo</span>                       <span class="kn">import</span> <span class="n">Gismo</span>
<span class="kn">from</span> <span class="nn">gismo.common</span>                <span class="kn">import</span> <span class="n">auto_k</span>
<span class="kn">from</span> <span class="nn">gismo.embedding</span>             <span class="kn">import</span> <span class="n">Embedding</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics.pairwise</span>    <span class="kn">import</span> <span class="n">cosine_similarity</span>
<span class="kn">from</span> <span class="nn">summarizer.building_summary</span> <span class="kn">import</span> <span class="n">is_relevant_sentence</span><span class="p">,</span> <span class="n">RE_CITATION</span><span class="p">,</span> <span class="n">RE_URL</span>
<span class="kn">from</span> <span class="nn">summarizer.gismo_wrapper</span>    <span class="kn">import</span> <span class="n">make_gismo</span>
<span class="kn">from</span> <span class="nn">summarizer.tokenizer</span>        <span class="kn">import</span> <span class="n">make_sentences</span><span class="p">,</span> <span class="n">num_words</span>

<span class="k">def</span> <span class="nf">is_relevant_sentence</span><span class="p">(</span><span class="n">sentence</span> <span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">min_num_words</span> <span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">max_num_words</span> <span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">60</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">num_words</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
    <span class="c1">#parsed_sentence = nlp(sentence)</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">min_num_words</span> <span class="o">&lt;=</span> <span class="n">n</span>
        <span class="ow">and</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">max_num_words</span>
        <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">RE_CITATION</span><span class="p">,</span> <span class="n">sentence</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">RE_URL</span><span class="p">,</span> <span class="n">sentence</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="c1">#    and &quot;VBZ&quot; in {token.tag_ for token in parsed_sentence}</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span>
    <span class="n">documents</span>          <span class="p">:</span><span class="nb">list</span><span class="p">,</span>
    <span class="n">query</span>              <span class="p">:</span><span class="nb">str</span>       <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">num_documents</span>      <span class="p">:</span><span class="nb">int</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_sentences</span>      <span class="p">:</span><span class="nb">int</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ratio</span>              <span class="p">:</span><span class="nb">float</span>     <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">embedding</span>          <span class="p">:</span><span class="n">Embedding</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">is_documents_embedding</span> <span class="p">:</span><span class="nb">bool</span>  <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">num_keywords</span>       <span class="p">:</span><span class="nb">int</span>       <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
    <span class="n">size_generic_query</span> <span class="p">:</span><span class="nb">int</span>       <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">used_sentences</span>     <span class="p">:</span><span class="nb">set</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">filter_sentences</span>              <span class="o">=</span> <span class="n">is_relevant_sentence</span><span class="p">,</span>
    <span class="n">get_content</span>                   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;abstract&quot;</span><span class="p">],</span>
    <span class="n">weight_s</span>           <span class="p">:</span><span class="nb">float</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">itf</span>                <span class="p">:</span><span class="nb">bool</span>      <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">covering</span>           <span class="p">:</span><span class="nb">bool</span>      <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">sim_to_query</span>       <span class="p">:</span><span class="nb">bool</span>      <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">query_distortion</span>   <span class="p">:</span><span class="nb">bool</span>      <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">length_textrank</span>    <span class="p">:</span><span class="nb">int</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">target_auto_k</span>      <span class="p">:</span><span class="nb">float</span>     <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="n">post</span>               <span class="p">:</span><span class="nb">bool</span>      <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Extended summarizer that produces a list of sentences and a list of keywords.</span>
<span class="sd">    Args:</span>
<span class="sd">        documents: A list of dict corresponding to documents.</span>
<span class="sd">        query: A string.</span>
<span class="sd">        num_documents: An int corresponding to the number of top documents</span>
<span class="sd">                        to be taking into account for the summary.</span>
<span class="sd">        num_sentences: An int corresponding of the number of sentences wanted in the summary.</span>
<span class="sd">        ratio: A float in [0, 1] giving the length of the summary</span>
<span class="sd">                as a proportion of the length of the num_documents kept.</span>
<span class="sd">        embedding: An Embedding fitted on a bigger corpus than documents.</span>
<span class="sd">        num_keywords: An int corresponding to the number of keywords returned</span>
<span class="sd">        used_sentences: A set of &quot;forbidden&quot; sentences.</span>
<span class="sd">        filter_sentences: A function returning a bool, allowing the selection of a sentence.</span>
<span class="sd">        get_content: A function that allows the retrieval of a document&#39;s content.</span>
<span class="sd">    Returns:</span>
<span class="sd">        A tuple containing:</span>
<span class="sd">            A list of the summary sentences,</span>
<span class="sd">            A list of keywords.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">num_sentences</span> <span class="ow">or</span> <span class="n">ratio</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span>

    <span class="k">if</span> <span class="n">used_sentences</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">used_sentences</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="c1"># Get number of documents</span>
    <span class="k">if</span> <span class="n">num_documents</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">num_documents</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>
    <span class="c1"># Find best documents</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">num_documents</span> <span class="o">!=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">num_documents</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">best_documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">documents</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">documents_gismo</span> <span class="o">=</span> <span class="n">make_gismo</span><span class="p">(</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="n">documents</span><span class="p">,</span>
            <span class="n">other_embedding</span> <span class="o">=</span> <span class="n">embedding</span><span class="p">,</span>
            <span class="n">is_documents_embedding</span> <span class="o">=</span> <span class="n">is_documents_embedding</span>
        <span class="p">)</span>
        <span class="n">documents_gismo</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">best_documents</span> <span class="o">=</span> <span class="n">documents_gismo</span><span class="o">.</span><span class="n">get_documents_by_rank</span><span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">num_documents</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">query</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">documents_gismo</span><span class="o">.</span><span class="n">get_features_by_rank</span><span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">size_generic_query</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;finding best documents : &quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
    <span class="c1"># Split best document into sentences.</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
    <span class="n">contents_sentences</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">sentence</span>
        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">best_documents</span>
        <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">make_sentences</span><span class="p">(</span><span class="n">get_content</span><span class="p">(</span><span class="n">document</span><span class="p">))</span>
    <span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Splitting best docs in sentences : &quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
    <span class="c1"># Scale the number of sentences proportionally to the total number</span>
    <span class="c1"># of sentences in the top documents.</span>
    <span class="k">if</span> <span class="n">num_sentences</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">num_sentences</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ratio</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">contents_sentences</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">streching_for_duplicates</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="k">if</span> <span class="n">itf</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
        <span class="n">embedding_idf</span> <span class="o">=</span> <span class="n">IdfEmbedding</span><span class="p">()</span>
        <span class="n">embedding_idf</span><span class="o">.</span><span class="n">fit_ext</span><span class="p">(</span><span class="n">embedding</span><span class="p">)</span>
        <span class="n">embedding_idf</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">Corpus</span><span class="p">(</span><span class="n">contents_sentences</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">document</span><span class="p">:</span> <span class="n">document</span><span class="p">))</span>
        <span class="n">sentences_gismo</span> <span class="o">=</span> <span class="n">make_gismo</span><span class="p">(</span>
            <span class="n">contents_sentences</span><span class="p">,</span>
            <span class="n">other_embedding</span> <span class="o">=</span> <span class="n">embedding_idf</span><span class="p">,</span>
            <span class="n">document_to_text</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">document</span><span class="p">:</span> <span class="n">document</span><span class="p">,</span>
            <span class="n">is_documents_embedding</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;creating idf sentences_gismo : &quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
        <span class="n">sentences_gismo</span> <span class="o">=</span> <span class="n">make_gismo</span><span class="p">(</span>
            <span class="n">contents_sentences</span><span class="p">,</span>
            <span class="n">other_embedding</span> <span class="o">=</span> <span class="n">embedding</span><span class="p">,</span>
            <span class="n">document_to_text</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">document</span><span class="p">:</span> <span class="n">document</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;creating itf sentences_gismo : &quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>

<span class="c1">#    print(&quot;Preparing sentence-based gismo&quot;)</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
    <span class="n">sentences_gismo</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">keywords</span> <span class="o">=</span> <span class="n">sentences_gismo</span><span class="o">.</span><span class="n">get_features_by_rank</span><span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">num_keywords</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">size_generic_query</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">size_generic_query</span> <span class="o">=</span> <span class="n">auto_k</span><span class="p">(</span>
            <span class="n">sentences_gismo</span><span class="o">.</span><span class="n">diteration</span><span class="o">.</span><span class="n">y_relevance</span><span class="p">,</span>
            <span class="n">max_k</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentences_gismo</span><span class="o">.</span><span class="n">diteration</span><span class="o">.</span><span class="n">y_relevance</span><span class="p">),</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">target_auto_k</span>
        <span class="p">)</span>

    <span class="c1">#if auto_k: query = sentences_gismo.get_features_by_rank</span>
    <span class="k">if</span> <span class="n">query</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">keywords</span><span class="p">[:</span><span class="n">size_generic_query</span><span class="p">])</span>
        <span class="n">sentences_gismo</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ranking sentences : &quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">post</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sentences_gismo</span><span class="o">.</span><span class="n">get_documents_by_rank</span><span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">num_sentences</span><span class="p">)</span>
<span class="c1"># MMR</span>
    <span class="k">if</span> <span class="n">weight_s</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">sim_to_query</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">sentences_dict</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;index&quot;</span>                <span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                    <span class="s2">&quot;sentence&quot;</span>             <span class="p">:</span> <span class="n">contents_sentences</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;score&quot;</span>                <span class="p">:</span> <span class="n">sentences_gismo</span><span class="o">.</span><span class="n">diteration</span><span class="o">.</span><span class="n">x_relevance</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;vector&quot;</span>               <span class="p">:</span> <span class="n">sentences_gismo</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">getrow</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                    <span class="s2">&quot;sim_to_sum&quot;</span>           <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;current_score&quot;</span>        <span class="p">:</span> <span class="n">sentences_gismo</span><span class="o">.</span><span class="n">diteration</span><span class="o">.</span><span class="n">x_relevance</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="c1">#            &quot;sim_to_sum_sentences&quot; : list()</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents_sentences</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">is_relevant_sentence</span><span class="p">(</span><span class="n">contents_sentences</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="n">contents_sentences</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_sentences</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span><span class="c1"># If score is similarity to query</span>
            <span class="n">query_vector</span> <span class="o">=</span> <span class="n">embedding</span><span class="o">.</span><span class="n">query_projection</span><span class="p">(</span><span class="n">query</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sentences_dict</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;index&quot;</span>                <span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                    <span class="s2">&quot;sentence&quot;</span>             <span class="p">:</span> <span class="n">contents_sentences</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;score&quot;</span>                <span class="p">:</span> <span class="n">cosine_similarity</span><span class="p">(</span>
                        <span class="n">embedding</span><span class="o">.</span><span class="n">query_projection</span><span class="p">(</span><span class="n">contents_sentences</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">query_vector</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;vector&quot;</span>               <span class="p">:</span> <span class="n">embedding</span><span class="o">.</span><span class="n">query_projection</span><span class="p">(</span><span class="n">contents_sentences</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="s2">&quot;sim_to_sum&quot;</span>           <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;current_score&quot;</span>        <span class="p">:</span> <span class="n">cosine_similarity</span><span class="p">(</span>
                        <span class="n">embedding</span><span class="o">.</span><span class="n">query_projection</span><span class="p">(</span><span class="n">contents_sentences</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">query_vector</span>
                    <span class="p">)</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents_sentences</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">is_relevant_sentence</span><span class="p">(</span><span class="n">contents_sentences</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">and</span>\
                    <span class="p">(</span><span class="n">contents_sentences</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_sentences</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sentences_dict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># None of the sentences are relevant (too short)!</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="n">sorted_sentences_dict</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="n">sentences_dict</span><span class="p">,</span>
            <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
            <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="p">)[:</span><span class="n">streching_for_duplicates</span><span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">num_sentences</span><span class="p">]</span>

        <span class="n">summary</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">new_sentence_dict</span> <span class="o">=</span> <span class="n">sorted_sentences_dict</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">streching_for_duplicates</span> <span class="o">*</span> <span class="n">num_sentences</span><span class="p">:</span>
            <span class="n">summary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_sentence_dict</span><span class="p">)</span>
            <span class="n">sorted_sentences_dict</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">new_sentence_dict</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sentence_dict</span> <span class="ow">in</span> <span class="n">sorted_sentences_dict</span><span class="p">:</span>
                    <span class="n">sim_to_new_sentence</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">sentence_dict</span><span class="p">[</span><span class="s2">&quot;vector&quot;</span><span class="p">],</span>\
                                                            <span class="n">new_sentence_dict</span><span class="p">[</span><span class="s2">&quot;vector&quot;</span><span class="p">])</span>
    <span class="c1">#                sentence_dict[&quot;sim_to_sum_sentences&quot;].append(sim_to_new_sentence)</span>
                    <span class="k">if</span> <span class="n">sim_to_new_sentence</span> <span class="o">&gt;</span> <span class="n">sentence_dict</span><span class="p">[</span><span class="s2">&quot;sim_to_sum&quot;</span><span class="p">]:</span>
                        <span class="n">sentence_dict</span><span class="p">[</span><span class="s2">&quot;sim_to_sum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sim_to_new_sentence</span>
                        <span class="n">sentence_dict</span><span class="p">[</span><span class="s2">&quot;current_score&quot;</span><span class="p">]</span> <span class="o">=</span> \
                            <span class="n">weight_s</span> <span class="o">*</span> <span class="n">sentence_dict</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">weight_s</span><span class="p">)</span> <span class="o">*</span> <span class="n">sentence_dict</span><span class="p">[</span><span class="s2">&quot;sim_to_sum&quot;</span><span class="p">]</span>
                <span class="n">new_sentence_dict</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sorted_sentences_dict</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">[</span><span class="s2">&quot;current_score&quot;</span><span class="p">])</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;not enough sentences to get to the required length&quot;</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering and MMR : &quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">covering</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span><span class="c1"># Gloutton</span>
        <span class="k">if</span> <span class="n">sim_to_query</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span> <span class="c1"># Sim to query Gloutton</span>
            <span class="n">query_vector</span> <span class="o">=</span> <span class="n">embedding</span><span class="o">.</span><span class="n">query_projection</span><span class="p">(</span><span class="n">query</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">summary</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;sentence&quot;</span> <span class="p">:</span> <span class="n">contents_sentences</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                        <span class="s2">&quot;index&quot;</span>    <span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                        <span class="s2">&quot;score&quot;</span>    <span class="p">:</span> <span class="n">cosine_similarity</span><span class="p">(</span>
                            <span class="n">embedding</span><span class="o">.</span><span class="n">query_projection</span><span class="p">(</span><span class="n">contents_sentences</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">],</span>
                            <span class="n">query_vector</span>
                        <span class="p">)</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">contents_sentences</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">is_relevant_sentence</span><span class="p">(</span><span class="n">contents_sentences</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">and</span>\
                        <span class="p">(</span><span class="n">contents_sentences</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_sentences</span><span class="p">)</span>
                <span class="p">],</span>
                <span class="n">key</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="n">k</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
                <span class="n">reverse</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="p">)[:(</span><span class="n">streching_for_duplicates</span> <span class="o">*</span> <span class="n">num_sentences</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># Gismo Gloutton</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
            <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;sentence&quot;</span> <span class="p">:</span> <span class="n">sentence</span><span class="p">,</span>
                    <span class="s2">&quot;index&quot;</span>    <span class="p">:</span> <span class="n">contents_sentences</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences_gismo</span><span class="o">.</span><span class="n">get_documents_by_rank</span><span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">num_sentences</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">is_relevant_sentence</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sentence</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_sentences</span><span class="p">)</span>
            <span class="p">][:</span><span class="n">streching_for_duplicates</span> <span class="o">*</span> <span class="n">num_sentences</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Filtering and Gloutton : &quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> <span class="c1"># Covering == True</span>
        <span class="n">sentences_gismo</span><span class="o">.</span><span class="n">query_distortion</span> <span class="o">=</span> <span class="n">query_distortion</span>
        <span class="n">sentences_gismo</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">strech</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">sentences_gismo</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">wide</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">&quot;sentence&quot;</span> <span class="p">:</span> <span class="n">sentence</span><span class="p">,</span>
                <span class="s2">&quot;index&quot;</span>    <span class="p">:</span> <span class="n">contents_sentences</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences_gismo</span><span class="o">.</span><span class="n">get_documents_by_coverage</span><span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">num_sentences</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">is_relevant_sentence</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sentence</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">used_sentences</span><span class="p">)</span>
        <span class="p">][:</span><span class="n">streching_for_duplicates</span> <span class="o">*</span> <span class="n">num_sentences</span><span class="p">]</span>

    <span class="c1"># Removing adverbs and nominal sentences, pronoun resolution</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
    <span class="n">sentences_to_remove</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">sum_index</span><span class="p">,</span> <span class="n">sentence_dict</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary</span><span class="p">):</span>
        <span class="n">sentence</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">sentence_dict</span><span class="p">[</span><span class="s2">&quot;sentence&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">sentence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="s2">&quot;ADV&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sentence</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">pos_</span> <span class="o">==</span> <span class="s2">&quot;PUNCT&quot;</span><span class="p">:</span>
                <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sentence</span> <span class="o">=</span> <span class="n">sentence</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="n">sentence_dict</span><span class="p">[</span><span class="s2">&quot;sentence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">text</span>
        <span class="k">if</span> <span class="s2">&quot;VBZ&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">sentence</span><span class="p">}:</span>
            <span class="c1">#summary.remove(sentence_dict)</span>
            <span class="n">sentences_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sentence_dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;PRP&quot;</span> <span class="ow">in</span> <span class="p">{</span><span class="n">token</span><span class="o">.</span><span class="n">tag_</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">sentence</span><span class="p">}:</span><span class="c1">#elif si VBZ ici</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sentence_dict</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">])</span>
            <span class="n">extract_str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">sentence</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">contents_sentences</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]])</span>
            <span class="n">extract</span> <span class="o">=</span> <span class="n">nlp</span><span class="p">(</span><span class="n">extract_str</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">extract</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">has_coref</span><span class="p">:</span>
                <span class="n">resolved_extract</span> <span class="o">=</span> <span class="n">extract</span><span class="o">.</span><span class="n">_</span><span class="o">.</span><span class="n">coref_resolved</span>
                <span class="n">sentence_dict</span><span class="p">[</span><span class="s2">&quot;sentence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_sentences</span><span class="p">(</span><span class="n">resolved_extract</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;coreference resolution and deleting adverbs : &quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
    <span class="c1"># Ordering the sentences given the similarities</span>
<span class="c1">#    ll_sims = np.array([np.array(sentence_dict[&quot;sim_to_sum_sentences&quot;]) for sentence_dict in summary])</span>
<span class="c1">#    pprint(ll_sims)</span>
<span class="c1">#    couples = list()</span>
<span class="c1">#    for i in range(len(summary) - 1):</span>
<span class="c1">#        ind1, ind2 = np.unravel_index(np.argmax(ll_sims, axis=None), ll_sims.shape)</span>
<span class="c1">#        couples.append(ind1 + 1, ind1)</span>
<span class="c1">#    pprint(couples)</span>

    <span class="n">summary</span> <span class="o">=</span> <span class="p">[</span><span class="n">sentence</span> <span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">summary</span> <span class="k">if</span> <span class="p">(</span><span class="n">sentence</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sentences_to_remove</span><span class="p">)]</span>

    <span class="k">if</span> <span class="n">length_textrank</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">sentence_dict</span><span class="p">[</span><span class="s2">&quot;sentence&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">sentence_dict</span> <span class="ow">in</span> <span class="n">summary</span><span class="p">[:</span><span class="n">num_sentences</span><span class="p">]]</span><span class="c1">#, keywords)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sentences_to_return</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">cpt</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sentences_to_return</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">length_textrank</span> <span class="ow">and</span> <span class="n">cpt</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">summary</span><span class="p">):</span>
            <span class="n">sentences_to_return</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="n">cpt</span><span class="p">][</span><span class="s2">&quot;sentence&quot;</span><span class="p">])</span>
            <span class="n">cpt</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">sentences_to_return</span>

<span class="c1">#    return sentences_gismo.get_documents_by_rank(k = num_sentences)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/usr/lib/python3.6/importlib/_bootstrap.py:219: RuntimeWarning: spacy.morphology.Morphology size changed, may indicate binary incompatibility. Expected 104 from C header, got 112 from PyObject
  return f(*args, **kwds)
/usr/lib/python3.6/importlib/_bootstrap.py:219: RuntimeWarning: spacy.vocab.Vocab size changed, may indicate binary incompatibility. Expected 96 from C header, got 112 from PyObject
  return f(*args, **kwds)
/home/melanie/.local/lib/python3.6/site-packages/spacy/util.py:275: UserWarning: [W031] Model &#39;en_core_web_sm&#39; (2.2.5) requires spaCy v2.2 and is incompatible with the current spaCy version (2.3.2). This may lead to unexpected results or runtime errors. To resolve this, download a newer compatible model or retrain your custom model with the current spaCy version. For more details and available updates, run: python -m spacy validate
  warnings.warn(warn_msg)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">test_summary</span> <span class="o">=</span> <span class="n">summarize</span><span class="p">(</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">DOCUMENTS</span><span class="p">,</span>
    <span class="n">num_documents</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;vaccine&quot;</span><span class="p">,</span>
    <span class="n">num_sentences</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">embedding</span> <span class="o">=</span> <span class="n">EMBEDDING</span><span class="p">,</span>
    <span class="n">is_documents_embedding</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">covering</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">itf</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">post</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">test_summary</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
finding best documents :  0.0032810000000154105
Splitting best docs in sentences :  0.027730000000019572
creating itf sentences_gismo :  0.0131059999999934
ranking sentences :  0.0018650000000093314
[&#39;Strains were classified as vaccine strains, when genetically identical or &#39;
 &#39;closely related (p-distance &lt; 0.01) to one of the applied vaccines, &#39;
 &#39;vaccine-derived strains, when genetically identical or closely related to a &#39;
 &#39;vaccine not administered in the respective flock, or field strains when not &#39;
 &#39;closely related (p-distance &gt; 0.01) to any known vaccine.&#39;,
 &#39;Of the 9 QX detections, 3 vaccine strains were detected in QX-vaccinated &#39;
 &#39;flocks, 2 were labeled as vaccine-derived strains, and 4 as field ones.&#39;,
 &#39;In all 72.8% of the 4/91 detections occurred in farms not adopting this &#39;
 &#39;vaccine, as opposed to 6.4% and none of the 1/96 and CR88 detections: the &#39;
 &#39;significant difference (P-value &lt; 0.001) suggests a higher spreading &#39;
 &#39;capability of the 4/91 vaccine compared to the 1/96based one, as previously &#39;
 &#39;reported (Franzo et al., 2014; Pellattiero et al., 2018) .&#39;,
 &#39;The number of vaccine-derived and field strains detected in symptomatic &#39;
 &#39;flocks is substantially equal, and this should stimulate a discussion on the &#39;
 &#39;advantages and disadvantages of a widespread, poorly-planned vaccine &#39;
 &#39;application.&#39;,
 &#39;Variant 2 strains were detected in 84 samples: 26 were classified as &#39;
 &#39;vaccine, 8 as vaccine-derived, and 51 as field strains, highlighting the &#39;
 &#39;persistence of this lineage in Poland in the considered period.&#39;]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[66]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">test_idf</span> <span class="o">=</span> <span class="n">summarize</span><span class="p">(</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">DOCUMENTS</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">num_documents</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">embedding</span> <span class="o">=</span> <span class="n">EMBEDDING</span><span class="p">,</span>
    <span class="n">itf</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span>
<span class="n">test_itf</span> <span class="o">=</span> <span class="n">summarize</span><span class="p">(</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">DOCUMENTS</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">ratio</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">num_documents</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">embedding</span> <span class="o">=</span> <span class="n">EMBEDDING</span><span class="p">,</span>
    <span class="n">itf</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_idf</span> <span class="o">==</span> <span class="n">test_itf</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
finding best documents :  0.007463999999970383
Splitting best docs in sentences :  0.007588999999995849
creating idf sentences_gismo :  0.003551000000015847
ranking sentences :  0.0010580000000004475
finding best documents :  0.006241999999986092
Splitting best docs in sentences :  0.008902000000034604
creating itf sentences_gismo :  0.004147999999986496
ranking sentences :  0.0007830000000126347
False
</pre></div></div>
</div>
<div class="section" id="Evaluation-of-the-summaries">
<h2>Evaluation of the summaries<a class="headerlink" href="#Evaluation-of-the-summaries" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">summarizer.simplified_documents</span> <span class="kn">import</span> <span class="n">get_abstract</span>
<span class="c1"># To get the time : time.clock()</span>

<span class="c1">#rand_indexes = np.random.randint(low = 0, high = len(DOCUMENTS), size = 100)</span>

<span class="n">rand_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4191</span><span class="p">,</span>    <span class="mi">1</span><span class="p">,</span> <span class="mi">5508</span><span class="p">,</span> <span class="mi">4807</span><span class="p">,</span> <span class="mi">4563</span><span class="p">,</span> <span class="mi">6221</span><span class="p">,</span> <span class="mi">5538</span><span class="p">,</span> <span class="mi">4568</span><span class="p">,</span> <span class="mi">5159</span><span class="p">,</span> <span class="mi">4371</span><span class="p">,</span> <span class="mi">2337</span><span class="p">,</span>
<span class="mi">2095</span><span class="p">,</span> <span class="mi">6399</span><span class="p">,</span> <span class="mi">5717</span><span class="p">,</span> <span class="mi">3555</span><span class="p">,</span> <span class="mi">5595</span><span class="p">,</span> <span class="mi">4451</span><span class="p">,</span> <span class="mi">6274</span><span class="p">,</span> <span class="mi">6309</span><span class="p">,</span>   <span class="mi">99</span><span class="p">,</span> <span class="mi">5019</span><span class="p">,</span>  <span class="mi">742</span><span class="p">,</span>
<span class="mi">3802</span><span class="p">,</span> <span class="mi">5413</span><span class="p">,</span> <span class="mi">3671</span><span class="p">,</span> <span class="mi">3873</span><span class="p">,</span>  <span class="mi">449</span><span class="p">,</span> <span class="mi">1485</span><span class="p">,</span>  <span class="mi">253</span><span class="p">,</span> <span class="mi">1835</span><span class="p">,</span> <span class="mi">3882</span><span class="p">,</span> <span class="mi">3164</span><span class="p">,</span> <span class="mi">4785</span><span class="p">,</span>
<span class="mi">6111</span><span class="p">,</span> <span class="mi">1843</span><span class="p">,</span> <span class="mi">2856</span><span class="p">,</span> <span class="mi">1740</span><span class="p">,</span> <span class="mi">4422</span><span class="p">,</span> <span class="mi">4930</span><span class="p">,</span> <span class="mi">5571</span><span class="p">,</span>   <span class="mi">97</span><span class="p">,</span>  <span class="mi">181</span><span class="p">,</span> <span class="mi">2043</span><span class="p">,</span> <span class="mi">5264</span><span class="p">,</span>
<span class="mi">1428</span><span class="p">,</span> <span class="mi">6272</span><span class="p">,</span> <span class="mi">6530</span><span class="p">,</span> <span class="mi">2855</span><span class="p">,</span> <span class="mi">1590</span><span class="p">,</span> <span class="mi">6315</span><span class="p">,</span> <span class="mi">3231</span><span class="p">,</span> <span class="mi">1564</span><span class="p">,</span> <span class="mi">2754</span><span class="p">,</span> <span class="mi">5505</span><span class="p">,</span> <span class="mi">5111</span><span class="p">,</span>
<span class="mi">1736</span><span class="p">,</span> <span class="mi">6166</span><span class="p">,</span> <span class="mi">1081</span><span class="p">,</span> <span class="mi">3809</span><span class="p">,</span> <span class="mi">6145</span><span class="p">,</span> <span class="mi">6281</span><span class="p">,</span> <span class="mi">5566</span><span class="p">,</span> <span class="mi">6043</span><span class="p">,</span> <span class="mi">6650</span><span class="p">,</span> <span class="mi">4010</span><span class="p">,</span> <span class="mi">3517</span><span class="p">,</span>
<span class="mi">1704</span><span class="p">,</span> <span class="mi">4145</span><span class="p">,</span> <span class="mi">4522</span><span class="p">,</span> <span class="mi">1641</span><span class="p">,</span> <span class="mi">2804</span><span class="p">,</span> <span class="mi">4097</span><span class="p">,</span> <span class="mi">3067</span><span class="p">,</span>  <span class="mi">553</span><span class="p">,</span>  <span class="mi">397</span><span class="p">,</span> <span class="mi">1092</span><span class="p">,</span> <span class="mi">6557</span><span class="p">,</span>
<span class="mi">1577</span><span class="p">,</span> <span class="mi">3858</span><span class="p">,</span> <span class="mi">3687</span><span class="p">,</span> <span class="mi">1504</span><span class="p">,</span> <span class="mi">1638</span><span class="p">,</span> <span class="mi">2141</span><span class="p">,</span> <span class="mi">1766</span><span class="p">,</span> <span class="mi">3652</span><span class="p">,</span> <span class="mi">5113</span><span class="p">,</span> <span class="mi">2896</span><span class="p">,</span> <span class="mi">6435</span><span class="p">,</span>
<span class="mi">6419</span><span class="p">,</span>  <span class="mi">959</span><span class="p">,</span> <span class="mi">1874</span><span class="p">,</span> <span class="mi">3189</span><span class="p">,</span> <span class="mi">6382</span><span class="p">,</span> <span class="mi">2610</span><span class="p">,</span> <span class="mi">5660</span><span class="p">,</span> <span class="mi">5783</span><span class="p">,</span> <span class="mi">6295</span><span class="p">,</span> <span class="mi">5148</span><span class="p">,</span> <span class="mi">4875</span><span class="p">,</span>
<span class="mi">5986</span><span class="p">])</span>

<span class="n">pprint</span><span class="p">(</span><span class="n">rand_indexes</span><span class="p">)</span>

<span class="n">DOC_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="n">DOCUMENTS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rand_indexes</span><span class="p">]</span>
<span class="n">ABSTRACTS</span> <span class="o">=</span> <span class="p">[</span><span class="n">DOCUMENTS</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;abstract&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rand_indexes</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([4191,    1, 5508, 4807, 4563, 6221, 5538, 4568, 5159, 4371, 2337,
       2095, 6399, 5717, 3555, 5595, 4451, 6274, 6309,   99, 5019,  742,
       3802, 5413, 3671, 3873,  449, 1485,  253, 1835, 3882, 3164, 4785,
       6111, 1843, 2856, 1740, 4422, 4930, 5571,   97,  181, 2043, 5264,
       1428, 6272, 6530, 2855, 1590, 6315, 3231, 1564, 2754, 5505, 5111,
       1736, 6166, 1081, 3809, 6145, 6281, 5566, 6043, 6650, 4010, 3517,
       1704, 4145, 4522, 1641, 2804, 4097, 3067,  553,  397, 1092, 6557,
       1577, 3858, 3687, 1504, 1638, 2141, 1766, 3652, 5113, 2896, 6435,
       6419,  959, 1874, 3189, 6382, 2610, 5660, 5783, 6295, 5148, 4875,
       5986])
</pre></div></div>
</div>
<div class="section" id="Tuning-parameters">
<h3>Tuning parameters<a class="headerlink" href="#Tuning-parameters" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[68]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#import numpy as np</span>
<span class="c1">#from summarizer.measures import cosine_sim, extended_jaccard, make_scores</span>
<span class="c1">#</span>
<span class="c1">#def make_gismo_summaries(contents_docs :list, abstracts :list, target_auto_k :float) -&gt; list:</span>
<span class="c1">#    summaries = list()</span>
<span class="c1">#    for (index_d, document) in enumerate(contents_docs):</span>
<span class="c1">#        abstract = abstracts[index_d]</span>
<span class="c1">#        our_hypothesis = &quot; &quot;.join(summarize(</span>
<span class="c1">#            documents = [document],</span>
<span class="c1">#            query = &quot;&quot;,</span>
<span class="c1">#            num_sentences = NUM_SENTENCES,</span>
<span class="c1">#            size_generic_query = None,</span>
<span class="c1">#            target_auto_k = target_auto_k</span>
<span class="c1">#        ))</span>
<span class="c1">#</span>
<span class="c1">#        summaries.append(</span>
<span class="c1">#            {</span>
<span class="c1">#                &quot;ref_sum&quot; : abstract,</span>
<span class="c1">#                &quot;our_sum&quot; : our_hypothesis,</span>
<span class="c1">#            }</span>
<span class="c1">#        )</span>
<span class="c1">#    return summaries</span>
<span class="c1">#</span>
<span class="c1">#right_value = 0</span>
<span class="c1">#max_means = 0</span>
<span class="c1">#for k in range(1, 5):</span>
<span class="c1">#    summaries = make_gismo_summaries(DOC_LIST, ABSTRACTS, k)</span>
<span class="c1">#    mean = np.mean(make_scores(summaries, &quot;our_sum&quot;, &quot;ref_sum&quot;, cosine_sim, EMBEDDING))</span>
<span class="c1">#    if mean &gt; max_means:</span>
<span class="c1">#        max_means = mean</span>
<span class="c1">#        right_value = k</span>
<span class="c1">#print(right_value)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="Other-known-summary-generation-systems-to-compare-ours-to">
<h1>Other known summary generation systems to compare ours to<a class="headerlink" href="#Other-known-summary-generation-systems-to-compare-ours-to" title="Permalink to this headline">¶</a></h1>
<p>We will use the <a class="reference external" href="https://radimrehurek.com/gensim/summarization/summariser.html">gensim summarization module</a> which implements the TextRank method (graph based method) to generate extractive summaries.</p>
<p>We will also use <a class="reference external" href="https://pypi.org/project/bert-extractive-summarizer/">bert extractive summarizer</a> which implements a centroïd based extractive summarozation system -&gt; impossible to use because of a cuda error.</p>
<p><code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">spacy</span> <span class="pre">download</span> <span class="pre">en_core_web_sm</span></code> needs to be done before using spacy (using gensim and bert)</p>
</div>
<div class="section" id="Comparing-summarizing-techniques">
<h1>Comparing summarizing techniques<a class="headerlink" href="#Comparing-summarizing-techniques" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">RATIO</span> <span class="o">=</span> <span class="mf">0.05</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">gensim.summarization.summarizer</span> <span class="k">as</span> <span class="nn">gen_sum</span>

<span class="n">mean_computation_time_gensim</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">TEXTRANK_TIMES</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">TEXTRANK_SUMMARIES</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">document</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">DOC_LIST</span><span class="p">):</span>
    <span class="c1">#num_char = len(GISMO_SUMMARIES[i])</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">TEXTRANK_SUMMARIES</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gen_sum</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">document</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">],</span> <span class="n">ratio</span> <span class="o">=</span> <span class="n">RATIO</span><span class="p">)</span>\
                                        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">))</span><span class="c1">#[:num_char])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">TEXTRANK_SUMMARIES</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">TEXTRANK_TIMES</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
    <span class="n">mean_computation_time_gensim</span> <span class="o">+=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
<span class="n">mean_computation_time_gensim</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">TEXTRANK_TIMES</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gismo.common</span> <span class="kn">import</span> <span class="n">auto_k</span>

<span class="n">mean_computation_time_gismo</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">GISMO_TIMES</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">GISMO_SUMMARIES</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">document</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">DOC_LIST</span><span class="p">):</span>
    <span class="n">num_sentences</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">make_sentences</span><span class="p">(</span><span class="n">TEXTRANK_SUMMARIES</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">real_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
    <span class="n">GISMO_SUMMARIES</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">summarize</span><span class="p">(</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">document</span><span class="p">],</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">num_sentences</span> <span class="o">=</span> <span class="n">num_sentences</span><span class="p">,</span>
            <span class="n">embedding</span> <span class="o">=</span> <span class="n">EMBEDDING</span><span class="p">,</span>
            <span class="n">weight_s</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="c1"># Vaut 1 si pas MMR</span>
            <span class="n">covering</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># ni MMR ni covering , on fait du glouton</span>
            <span class="n">sim_to_query</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">itf</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="c1">#query_distortion = False,</span>
            <span class="n">length_textrank</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">TEXTRANK_SUMMARIES</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
            <span class="n">post</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">size_generic_query</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
            <span class="c1">#size_generic_query = None,</span>
            <span class="c1">#target_auto_k = 3</span>
        <span class="p">))</span><span class="c1">#[:len(TEXTRANK_SUMMARIES[i])]</span>

    <span class="p">)</span>
    <span class="n">GISMO_TIMES</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">real_start_time</span><span class="p">)</span>
    <span class="n">mean_computation_time_gismo</span> <span class="o">+=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">real_start_time</span>
<span class="n">mean_computation_time_gismo</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">GISMO_TIMES</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
finding best documents :  2.00000000916134e-06
Splitting best docs in sentences :  0.016528000000008092
creating idf sentences_gismo :  0.013237000000003718
ranking sentences :  1.082104000000001
Filtering and Gloutton :  0.005567999999996687
coreference resolution and deleting adverbs :  2.568291000000002
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.007176000000001181
creating idf sentences_gismo :  0.005969999999990705
ranking sentences :  0.009597999999996887
Filtering and Gloutton :  0.003115999999991459
coreference resolution and deleting adverbs :  1.8556880000000007
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.007789000000002488
creating idf sentences_gismo :  0.006764000000003989
ranking sentences :  0.010153999999999996
Filtering and Gloutton :  0.0073930000000075324
coreference resolution and deleting adverbs :  2.969423000000006
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.006888000000003558
creating idf sentences_gismo :  0.006416999999999007
ranking sentences :  0.009759999999999991
Filtering and Gloutton :  0.006320000000016535
coreference resolution and deleting adverbs :  2.229555000000005
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.007077999999978601
creating idf sentences_gismo :  0.006855999999999085
ranking sentences :  0.009855000000015934
Filtering and Gloutton :  0.0063370000000020354
coreference resolution and deleting adverbs :  2.6667010000000175
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.006730000000004566
creating idf sentences_gismo :  0.006129999999984648
ranking sentences :  0.00969299999999862
Filtering and Gloutton :  0.005456000000009453
coreference resolution and deleting adverbs :  2.1246229999999855
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0030950000000018463
creating idf sentences_gismo :  0.005000999999992928
ranking sentences :  0.009367000000025882
Filtering and Gloutton :  0.0029789999999820793
coreference resolution and deleting adverbs :  1.2419639999999958
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.007558999999986327
creating idf sentences_gismo :  0.0068389999999851625
ranking sentences :  0.009751000000022714
Filtering and Gloutton :  0.007135999999974274
coreference resolution and deleting adverbs :  3.1130540000000053
finding best documents :  1.0000000258969521e-06
Splitting best docs in sentences :  0.003198999999995067
creating idf sentences_gismo :  0.0050459999999930005
ranking sentences :  0.009309999999999263
Filtering and Gloutton :  0.0020409999999912998
coreference resolution and deleting adverbs :  0.8169080000000122
finding best documents :  1.0000000258969521e-06
Splitting best docs in sentences :  0.006412000000011631
creating idf sentences_gismo :  0.006737000000015314
ranking sentences :  0.00996200000000158
Filtering and Gloutton :  0.006526000000008025
coreference resolution and deleting adverbs :  2.832146999999992
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.008455999999995356
creating idf sentences_gismo :  0.007182000000000244
ranking sentences :  0.010045999999988453
Filtering and Gloutton :  0.007468000000017128
coreference resolution and deleting adverbs :  2.747399999999999
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.00371100000000979
creating idf sentences_gismo :  0.005500000000012051
ranking sentences :  0.009439999999983684
Filtering and Gloutton :  0.003260000000011587
coreference resolution and deleting adverbs :  1.2039989999999818
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.004472000000021126
creating idf sentences_gismo :  0.0055080000000202745
ranking sentences :  0.009430999999977985
Filtering and Gloutton :  0.0038080000000206837
coreference resolution and deleting adverbs :  1.7936109999999985
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.005843999999996186
creating idf sentences_gismo :  0.0055680000000108976
ranking sentences :  0.009629999999987149
Filtering and Gloutton :  0.004672999999996819
coreference resolution and deleting adverbs :  1.9704299999999932
finding best documents :  1.0000000258969521e-06
Splitting best docs in sentences :  0.004614000000003671
creating idf sentences_gismo :  0.00547599999998738
ranking sentences :  0.009577000000007274
Filtering and Gloutton :  0.004465000000010377
coreference resolution and deleting adverbs :  1.9351300000000151
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.006236999999998716
creating idf sentences_gismo :  0.005786000000000513
ranking sentences :  0.009848000000005186
Filtering and Gloutton :  0.004059999999981301
coreference resolution and deleting adverbs :  0.8496900000000096
finding best documents :  1.9999999949504854e-06
Splitting best docs in sentences :  0.005182999999988169
creating idf sentences_gismo :  0.005374999999986585
ranking sentences :  0.009279000000020687
Filtering and Gloutton :  0.0041139999999870724
coreference resolution and deleting adverbs :  1.6693300000000022
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0029339999999820066
creating idf sentences_gismo :  0.004736000000008289
ranking sentences :  0.009312999999991689
Filtering and Gloutton :  0.0025929999999902975
coreference resolution and deleting adverbs :  1.322355000000016
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.006888000000003558
creating idf sentences_gismo :  0.00720900000001734
ranking sentences :  0.009840999999994438
Filtering and Gloutton :  0.007221999999984519
coreference resolution and deleting adverbs :  2.509746999999976
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.005702000000013641
creating idf sentences_gismo :  0.005720999999994092
ranking sentences :  0.00971700000002329
Filtering and Gloutton :  0.004617999999993572
coreference resolution and deleting adverbs :  1.9476250000000164
finding best documents :  3.0000000208474376e-06
Splitting best docs in sentences :  0.0031700000000114414
creating idf sentences_gismo :  0.004511000000007925
ranking sentences :  0.009487000000007129
Filtering and Gloutton :  0.0034870000000069012
coreference resolution and deleting adverbs :  1.157874000000021
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.006001999999995178
creating idf sentences_gismo :  0.006506999999999152
ranking sentences :  0.009805999999997539
Filtering and Gloutton :  0.005345000000005484
coreference resolution and deleting adverbs :  3.2782920000000217
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.004350000000016507
creating idf sentences_gismo :  0.005684000000002243
ranking sentences :  0.009473000000014054
Filtering and Gloutton :  0.003666000000009717
coreference resolution and deleting adverbs :  1.2966590000000053
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.006544999999988477
creating idf sentences_gismo :  0.006139999999987822
ranking sentences :  0.009620000000012396
Filtering and Gloutton :  0.006171999999992295
coreference resolution and deleting adverbs :  2.6582190000000026
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.005293000000023085
creating idf sentences_gismo :  0.00572800000000484
ranking sentences :  0.009508000000010952
Filtering and Gloutton :  0.0037169999999946413
coreference resolution and deleting adverbs :  1.3253840000000139
finding best documents :  1.0000000258969521e-06
Splitting best docs in sentences :  0.0037130000000047403
creating idf sentences_gismo :  0.005122000000000071
ranking sentences :  0.009438000000017155
Filtering and Gloutton :  0.002976999999987129
coreference resolution and deleting adverbs :  1.3518139999999903
finding best documents :  1.0000000258969521e-06
Splitting best docs in sentences :  0.014731000000011818
creating idf sentences_gismo :  0.009092999999978701
ranking sentences :  0.010803999999978942
Filtering and Gloutton :  0.012333999999981415
coreference resolution and deleting adverbs :  5.011804000000012
finding best documents :  1.0000000258969521e-06
Splitting best docs in sentences :  0.0031210000000214677
creating idf sentences_gismo :  0.004704000000003816
ranking sentences :  0.009273000000007414
Filtering and Gloutton :  0.002459000000015976
coreference resolution and deleting adverbs :  0.9628219999999885
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.006547000000011849
creating idf sentences_gismo :  0.005593000000004622
ranking sentences :  0.009491999999994505
Filtering and Gloutton :  0.004386000000010881
coreference resolution and deleting adverbs :  2.016680000000008
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0023339999999905103
creating idf sentences_gismo :  0.004729999999995016
ranking sentences :  0.009321999999997388
Filtering and Gloutton :  0.0018369999999947595
coreference resolution and deleting adverbs :  0.9648320000000012
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0027829999999937627
creating idf sentences_gismo :  0.004837000000009084
ranking sentences :  0.009312999999991689
Filtering and Gloutton :  0.0018539999999802603
coreference resolution and deleting adverbs :  0.9049199999999757
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.011561000000000377
creating idf sentences_gismo :  0.008307000000002063
ranking sentences :  0.010501000000004979
Filtering and Gloutton :  0.011077000000000226
coreference resolution and deleting adverbs :  5.235160000000008
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0030290000000263717
creating idf sentences_gismo :  0.0049960000000055516
ranking sentences :  0.009436000000022204
Filtering and Gloutton :  0.00249500000001035
coreference resolution and deleting adverbs :  0.7885159999999871
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.008372000000008484
creating idf sentences_gismo :  0.006985999999983505
ranking sentences :  0.00984500000001276
Filtering and Gloutton :  0.007312999999982139
coreference resolution and deleting adverbs :  1.9779359999999997
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0022490000000061627
creating idf sentences_gismo :  0.004565000000013697
ranking sentences :  0.009157999999985122
Filtering and Gloutton :  0.0016960000000096898
coreference resolution and deleting adverbs :  0.49522699999999986
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0030409999999960746
creating idf sentences_gismo :  0.004573000000021921
ranking sentences :  0.009230999999999767
Filtering and Gloutton :  0.0022610000000042874
coreference resolution and deleting adverbs :  0.9584010000000092
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0071159999999963475
creating idf sentences_gismo :  0.0061440000000061445
ranking sentences :  0.009582999999992126
Filtering and Gloutton :  0.006022000000001526
coreference resolution and deleting adverbs :  2.288562000000013
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.004516000000023723
creating idf sentences_gismo :  0.005655000000018617
ranking sentences :  0.009361999999981663
Filtering and Gloutton :  0.0038059999999973115
coreference resolution and deleting adverbs :  1.64871100000002
finding best documents :  1.9999999949504854e-06
Splitting best docs in sentences :  0.0032379999999818665
creating idf sentences_gismo :  0.0049820000000124764
ranking sentences :  0.00926100000000929
Filtering and Gloutton :  0.002835000000004584
coreference resolution and deleting adverbs :  1.3835400000000107
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.011668999999983498
creating idf sentences_gismo :  0.008236999999979844
ranking sentences :  0.010531000000014501
Filtering and Gloutton :  0.009478999999998905
coreference resolution and deleting adverbs :  4.060195999999991
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.008654000000007045
creating idf sentences_gismo :  0.007170000000002119
ranking sentences :  0.009917000000001508
Filtering and Gloutton :  0.007444000000020878
coreference resolution and deleting adverbs :  3.3706280000000106
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.004998000000000502
creating idf sentences_gismo :  0.005924000000021579
ranking sentences :  0.009491999999994505
Filtering and Gloutton :  0.00402800000000525
coreference resolution and deleting adverbs :  1.1446080000000052
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0018929999999954816
creating idf sentences_gismo :  0.004108999999999696
ranking sentences :  0.009067000000015923
Filtering and Gloutton :  0.0013480000000072323
coreference resolution and deleting adverbs :  0.4362769999999898
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.004231000000004315
creating idf sentences_gismo :  0.0053420000000130585
ranking sentences :  0.009444000000002006
Filtering and Gloutton :  0.003696999999988293
coreference resolution and deleting adverbs :  1.319609999999983
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.002303999999980988
creating idf sentences_gismo :  0.0045769999999834
ranking sentences :  0.00917799999999147
Filtering and Gloutton :  0.001322999999985086
coreference resolution and deleting adverbs :  0.22548900000001026
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0013000000000147338
creating idf sentences_gismo :  0.00392800000000193
ranking sentences :  0.008927999999997382
Filtering and Gloutton :  0.0009969999999839274
coreference resolution and deleting adverbs :  0.6289330000000177
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.005597999999991998
creating idf sentences_gismo :  0.005814000000015085
ranking sentences :  0.009624000000002297
Filtering and Gloutton :  0.004775999999992564
coreference resolution and deleting adverbs :  2.5815559999999778
finding best documents :  1.0000000258969521e-06
Splitting best docs in sentences :  0.009417000000013331
creating idf sentences_gismo :  0.0077339999999992415
ranking sentences :  0.010367000000002236
Filtering and Gloutton :  0.008775000000014188
coreference resolution and deleting adverbs :  5.1188040000000115
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0044549999999787815
creating idf sentences_gismo :  0.005888999999996258
ranking sentences :  0.009651000000019394
Filtering and Gloutton :  0.00385399999998981
coreference resolution and deleting adverbs :  1.750066000000004
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.006469000000009828
creating idf sentences_gismo :  0.006524999999982128
ranking sentences :  0.00983400000001211
Filtering and Gloutton :  0.005654999999990196
coreference resolution and deleting adverbs :  1.858665000000002
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.00646399999999403
creating idf sentences_gismo :  0.005660000000005994
ranking sentences :  0.009477000000003954
Filtering and Gloutton :  0.004765000000020336
coreference resolution and deleting adverbs :  2.347276999999991
finding best documents :  1.9999999949504854e-06
Splitting best docs in sentences :  0.005846000000019558
creating idf sentences_gismo :  0.005407999999988533
ranking sentences :  0.009534999999999627
Filtering and Gloutton :  0.004261000000013837
coreference resolution and deleting adverbs :  1.7936940000000163
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.010932999999994308
creating idf sentences_gismo :  0.008852999999987787
ranking sentences :  0.010890000000017608
Filtering and Gloutton :  0.010788999999988391
coreference resolution and deleting adverbs :  5.022475000000014
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.004815000000007785
creating idf sentences_gismo :  0.005675999999994019
ranking sentences :  0.00955200000001355
Filtering and Gloutton :  0.004735999999979867
coreference resolution and deleting adverbs :  2.842897999999991
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0023349999999879856
creating idf sentences_gismo :  0.004615000000001146
ranking sentences :  0.009271000000012464
Filtering and Gloutton :  0.0013810000000091804
coreference resolution and deleting adverbs :  0.2491730000000132
finding best documents :  1.9999999949504854e-06
Splitting best docs in sentences :  0.0024959999999794036
creating idf sentences_gismo :  0.005134999999995671
ranking sentences :  0.009381999999988011
Filtering and Gloutton :  0.0022189999999966403
coreference resolution and deleting adverbs :  0.6677899999999966
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.007161000000024842
creating idf sentences_gismo :  0.007052999999984877
ranking sentences :  0.010376999999976988
Filtering and Gloutton :  0.006369000000006508
coreference resolution and deleting adverbs :  2.7724599999999953
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.006615000000010696
creating idf sentences_gismo :  0.006280000000003838
ranking sentences :  0.009677999999979647
Filtering and Gloutton :  0.006521999999989703
coreference resolution and deleting adverbs :  2.7827350000000024
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.004935999999986507
creating idf sentences_gismo :  0.0051149999999893225
ranking sentences :  0.010072000000008074
Filtering and Gloutton :  0.0038800000000094315
coreference resolution and deleting adverbs :  2.0202060000000017
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.01079599999999914
creating idf sentences_gismo :  0.008005999999994629
ranking sentences :  0.01049399999999423
Filtering and Gloutton :  0.010238999999984344
coreference resolution and deleting adverbs :  5.198892999999998
finding best documents :  1.0000000258969521e-06
Splitting best docs in sentences :  0.006664000000000669
creating idf sentences_gismo :  0.0067659999999989395
ranking sentences :  0.009926000000007207
Filtering and Gloutton :  0.005445000000008804
coreference resolution and deleting adverbs :  1.781517000000008
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0038930000000050313
creating idf sentences_gismo :  0.0061300000000130694
ranking sentences :  0.011782999999979893
Filtering and Gloutton :  0.002681999999992968
coreference resolution and deleting adverbs :  1.036687999999998
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0030399999999985994
creating idf sentences_gismo :  0.0050740000000075725
ranking sentences :  0.00963000000001557
Filtering and Gloutton :  0.00265099999998597
coreference resolution and deleting adverbs :  0.9548559999999782
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0031779999999912434
creating idf sentences_gismo :  0.005234000000001515
ranking sentences :  0.010369999999994661
Filtering and Gloutton :  0.003391999999990958
coreference resolution and deleting adverbs :  1.0897560000000226
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.006378999999981261
creating idf sentences_gismo :  0.006200000000006867
ranking sentences :  0.009910999999988235
Filtering and Gloutton :  0.00496999999998593
coreference resolution and deleting adverbs :  1.8972059999999829
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.002441000000033
creating idf sentences_gismo :  0.0045630000000187465
ranking sentences :  0.00968000000000302
Filtering and Gloutton :  0.0019169999999917309
coreference resolution and deleting adverbs :  1.010719999999992
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.008880999999973938
creating idf sentences_gismo :  0.006983999999988555
ranking sentences :  0.009788000000014563
Filtering and Gloutton :  0.0073499999999739885
coreference resolution and deleting adverbs :  4.511089999999967
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0035110000000031505
creating idf sentences_gismo :  0.005469000000005053
ranking sentences :  0.009617999999989024
Filtering and Gloutton :  0.0033889999999701104
coreference resolution and deleting adverbs :  2.1856709999999566
finding best documents :  1.9999999949504854e-06
Splitting best docs in sentences :  0.0025519999999801257
creating idf sentences_gismo :  0.004714999999976044
ranking sentences :  0.009134999999957927
Filtering and Gloutton :  0.0018509999999878346
coreference resolution and deleting adverbs :  0.6111960000000067
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0015890000000240434
creating idf sentences_gismo :  0.0044480000000248765
ranking sentences :  0.009355000000027758
Filtering and Gloutton :  0.00101399999999785
coreference resolution and deleting adverbs :  0.3427469999999744
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.006854000000032556
creating idf sentences_gismo :  0.006460000000004129
ranking sentences :  0.00990999999999076
Filtering and Gloutton :  0.00576699999999164
coreference resolution and deleting adverbs :  2.5851839999999697
finding best documents :  1.9999999949504854e-06
Splitting best docs in sentences :  0.006097000000011121
creating idf sentences_gismo :  0.006819000000007236
ranking sentences :  0.012163000000043667
Filtering and Gloutton :  0.004820999999992637
coreference resolution and deleting adverbs :  1.862324000000001
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0032260000000405853
creating idf sentences_gismo :  0.004919000000029428
ranking sentences :  0.009346999999991112
Filtering and Gloutton :  0.003072999999972126
coreference resolution and deleting adverbs :  2.099115999999981
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.006539999999972679
creating idf sentences_gismo :  0.006164000000012493
ranking sentences :  0.009703000000001794
Filtering and Gloutton :  0.004458999999997104
coreference resolution and deleting adverbs :  1.3190159999999764
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0057530000000269865
creating idf sentences_gismo :  0.005606999999997697
ranking sentences :  0.00939099999999371
Filtering and Gloutton :  0.004336000000023432
coreference resolution and deleting adverbs :  1.0320370000000025
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.004065999999966152
creating idf sentences_gismo :  0.004874000000029355
ranking sentences :  0.009298999999998614
Filtering and Gloutton :  0.003520999999977903
coreference resolution and deleting adverbs :  1.4362160000000017
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.002238000000033935
creating idf sentences_gismo :  0.004568000000006123
ranking sentences :  0.009102000000041244
Filtering and Gloutton :  0.0018010000000003856
coreference resolution and deleting adverbs :  0.7905039999999985
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.004001000000016575
creating idf sentences_gismo :  0.005293999999992138
ranking sentences :  0.009447000000022854
Filtering and Gloutton :  0.0036249999999995453
coreference resolution and deleting adverbs :  1.3368750000000205
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.003215000000011514
creating idf sentences_gismo :  0.00568500000002814
ranking sentences :  0.009944000000018605
Filtering and Gloutton :  0.003471999999987929
coreference resolution and deleting adverbs :  1.408625000000029
finding best documents :  2.999999992425728e-06
Splitting best docs in sentences :  0.00411700000000792
creating idf sentences_gismo :  0.005523999999979878
ranking sentences :  0.011293000000023312
Filtering and Gloutton :  0.003026000000033946
coreference resolution and deleting adverbs :  1.0748399999999947
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.00947600000000648
creating idf sentences_gismo :  0.007866000000035456
ranking sentences :  0.012173000000018419
Filtering and Gloutton :  0.007695999999953074
coreference resolution and deleting adverbs :  2.6521880000000237
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0019920000000297478
creating idf sentences_gismo :  0.005512000000010175
ranking sentences :  0.012477999999987333
Filtering and Gloutton :  0.002308999999968364
coreference resolution and deleting adverbs :  1.087554999999952
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.014048999999999978
creating idf sentences_gismo :  0.009330999999974665
ranking sentences :  0.010441000000014355
Filtering and Gloutton :  0.01334100000002536
coreference resolution and deleting adverbs :  7.800874000000022
finding best documents :  1.0000000543186616e-06
Splitting best docs in sentences :  0.00628799999998364
creating idf sentences_gismo :  0.006996999999955733
ranking sentences :  0.009688000000039665
Filtering and Gloutton :  0.005900999999994383
coreference resolution and deleting adverbs :  2.5874640000000113
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.004280999999991764
creating idf sentences_gismo :  0.005463000000020202
ranking sentences :  0.01185099999997874
Filtering and Gloutton :  0.00400200000001405
coreference resolution and deleting adverbs :  1.8492560000000253
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.006852999999978238
creating idf sentences_gismo :  0.006618000000003121
ranking sentences :  0.009790000000009513
Filtering and Gloutton :  0.006602999999984149
coreference resolution and deleting adverbs :  3.5831470000000536
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0020560000000386935
creating idf sentences_gismo :  0.004771000000005188
ranking sentences :  0.011493999999970583
Filtering and Gloutton :  0.002040999999962878
coreference resolution and deleting adverbs :  0.6135610000000042
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.01361999999994623
creating idf sentences_gismo :  0.010140000000035343
ranking sentences :  0.012464999999963311
Filtering and Gloutton :  0.0130500000000211
coreference resolution and deleting adverbs :  5.94770699999998
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.007302999999978965
creating idf sentences_gismo :  0.0064950000000294494
ranking sentences :  0.009779000000037286
Filtering and Gloutton :  0.006415000000004056
coreference resolution and deleting adverbs :  3.3208589999999845
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0016929999999888423
creating idf sentences_gismo :  0.005673999999999069
ranking sentences :  0.012176000000010845
Filtering and Gloutton :  0.0019369999999980791
coreference resolution and deleting adverbs :  0.604692
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.007339000000001761
creating idf sentences_gismo :  0.006307999999989988
ranking sentences :  0.009892999999976837
Filtering and Gloutton :  0.0060330000000021755
coreference resolution and deleting adverbs :  2.3954990000000294
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.01008600000000115
creating idf sentences_gismo :  0.007813999999996213
ranking sentences :  0.010009000000025026
Filtering and Gloutton :  0.00977299999999559
coreference resolution and deleting adverbs :  3.7687030000000163
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.022708999999963453
creating idf sentences_gismo :  0.013168000000007396
ranking sentences :  0.01214399999997795
Filtering and Gloutton :  0.01822900000001937
coreference resolution and deleting adverbs :  4.7893190000000345
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.005091000000049917
creating idf sentences_gismo :  0.005499999999983629
ranking sentences :  0.00944699999996601
Filtering and Gloutton :  0.004266000000029635
coreference resolution and deleting adverbs :  1.4587950000000092
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.003527000000019598
creating idf sentences_gismo :  0.005162999999981821
ranking sentences :  0.009422999999969761
Filtering and Gloutton :  0.0033389999999826614
coreference resolution and deleting adverbs :  1.305422999999962
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.004815000000007785
creating idf sentences_gismo :  0.00550900000001775
ranking sentences :  0.009398999999973512
Filtering and Gloutton :  0.004033999999990101
coreference resolution and deleting adverbs :  1.7352980000000002
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.00634900000000016
creating idf sentences_gismo :  0.0059180000000083055
ranking sentences :  0.009805000000028485
Filtering and Gloutton :  0.004365000000007058
coreference resolution and deleting adverbs :  1.7740459999999985
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.015548000000023876
creating idf sentences_gismo :  0.008941999999990458
ranking sentences :  0.010332000000005337
Filtering and Gloutton :  0.012507000000027801
coreference resolution and deleting adverbs :  6.2547779999999875
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.0075949999999807005
creating idf sentences_gismo :  0.006710999999995693
ranking sentences :  0.00986500000004753
Filtering and Gloutton :  0.007321999999987838
coreference resolution and deleting adverbs :  2.8075269999999932
finding best documents :  9.999999974752427e-07
Splitting best docs in sentences :  0.031894000000022515
creating idf sentences_gismo :  0.01678900000001704
ranking sentences :  0.012301999999976942
Filtering and Gloutton :  0.032779000000005
coreference resolution and deleting adverbs :  11.83548300000001
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">x_axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">TEXTRANK_SUMMARIES</span><span class="p">))]</span>

<span class="n">y_axes_1</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span> <span class="k">for</span> <span class="n">summary</span> <span class="ow">in</span> <span class="n">GISMO_SUMMARIES</span><span class="p">]</span>
<span class="n">y_axes_2</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span> <span class="k">for</span> <span class="n">summary</span> <span class="ow">in</span> <span class="n">TEXTRANK_SUMMARIES</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;indice résumé&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;nombre de caractères&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;comparaison de la taille des résumés produits en nombre de caractères&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axes</span><span class="p">,</span> <span class="n">y_axes_1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gismo sequential summarize&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axes</span><span class="p">,</span> <span class="n">y_axes_2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TextRank summarize&quot;</span><span class="p">)</span>


<span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_covid_summarizer_46_0.png" src="../_images/tutorials_covid_summarizer_46_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[126]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#from summarizer.tokenizer import words</span>
<span class="c1">#</span>
<span class="c1">#avg_length = 0</span>
<span class="c1">#for summary in GISMO_SUMMARIES:</span>
<span class="c1">#    avg_length += len(words(summary))</span>
<span class="c1">#avg_length /= len(GISMO_SUMMARIES)</span>
<span class="c1">#WORD_COUNT = int(avg_length)</span>
<span class="c1">#print(WORD_COUNT)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean computation time of Gismo summarizer : </span><span class="si">%s</span><span class="s2"> seconds&quot;</span> <span class="o">%</span> <span class="n">mean_computation_time_gismo</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean computation time of TextRank summarizer : </span><span class="si">%s</span><span class="s2"> seconds&quot;</span> <span class="o">%</span> <span class="n">mean_computation_time_gensim</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gismo based summarizer is </span><span class="si">%s</span><span class="s2"> times faster than TextRank summarizer&quot;</span> <span class="o">%</span> \
      <span class="p">(</span><span class="n">mean_computation_time_gensim</span> <span class="o">/</span> <span class="n">mean_computation_time_gismo</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mean computation time of Gismo summarizer : 2.267292610000001 seconds
Mean computation time of TextRank summarizer : 0.9012875099999996 seconds
Gismo based summarizer is 0.3975170677242225 times faster than TextRank summarizer
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">SUMMARIES</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="c1"># To compute our summaries</span>
<span class="n">cpt</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rand_indexes</span><span class="p">:</span>
    <span class="n">abstract</span> <span class="o">=</span> <span class="n">DOCUMENTS</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;abstract&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">GISMO_SUMMARIES</span><span class="p">[</span><span class="n">cpt</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">TEXTRANK_SUMMARIES</span><span class="p">[</span><span class="n">cpt</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">SUMMARIES</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;ref_sum&quot;</span> <span class="p">:</span> <span class="n">abstract</span><span class="p">,</span>
                <span class="s2">&quot;our_sum&quot;</span> <span class="p">:</span> <span class="n">GISMO_SUMMARIES</span><span class="p">[</span><span class="n">cpt</span><span class="p">],</span>
                <span class="s2">&quot;gensim_sum&quot;</span> <span class="p">:</span> <span class="n">TEXTRANK_SUMMARIES</span><span class="p">[</span><span class="n">cpt</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="n">cpt</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SUMMARIES</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
97
</pre></div></div>
</div>
</div>
<div class="section" id="Execution-time-comparision">
<h1>Execution time comparision<a class="headerlink" href="#Execution-time-comparision" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">tikzplotlib</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">make_times_plot</span><span class="p">(</span><span class="n">gismo_times</span> <span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">textrank_times</span> <span class="p">:</span><span class="nb">list</span><span class="p">):</span>
    <span class="n">x_vect</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gismo_times</span><span class="p">))]</span>
    <span class="n">x_axes</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">100</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">gismo_times</span><span class="p">))</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x_vect</span><span class="p">]</span>
    <span class="n">y_axes_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">gismo_times</span><span class="p">))</span>
    <span class="n">y_axes_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">textrank_times</span><span class="p">))</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Documents&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Log des temps d&#39;exécution en secondes&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Log des sommes cumulées des temps d&#39;exécution&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axes</span><span class="p">,</span> <span class="n">y_axes_1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gismo&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axes</span><span class="p">,</span> <span class="n">y_axes_2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TextRank&quot;</span><span class="p">)</span>

    <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">make_times_plot</span><span class="p">(</span><span class="n">GISMO_TIMES</span><span class="p">,</span> <span class="n">TEXTRANK_TIMES</span><span class="p">)</span>


</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_covid_summarizer_52_0.png" src="../_images/tutorials_covid_summarizer_52_0.png" />
</div>
</div>
</div>
<div class="section" id="ROUGE-metrics">
<h1>ROUGE metrics<a class="headerlink" href="#ROUGE-metrics" title="Permalink to this headline">¶</a></h1>
<p>The implementation of these metrics is based on Lin’s article <a class="reference external" href="https://www.aclweb.org/anthology/W04-1013/">ROUGE : A Package for Automatic Evaluation of Summaries</a>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">summarizer.measures</span> <span class="kn">import</span> <span class="n">make_rouge_scores</span><span class="p">,</span> <span class="n">make_scores_plot</span><span class="p">,</span> <span class="n">make_diff_scores_plot</span>
<span class="kn">from</span> <span class="nn">summarizer.measures</span> <span class="kn">import</span> <span class="n">rouge_l</span><span class="p">,</span> <span class="n">rouge_n</span><span class="p">,</span> <span class="n">rouge_s</span>
<span class="k">def</span> <span class="nf">make_rouge_scores</span><span class="p">(</span><span class="n">summaries</span> <span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">candidate_key</span> <span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">ref_key</span> <span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes ROUGE scores for a list of candidate summaries and the corresponding reference summaries</span>
<span class="sd">    Args:</span>
<span class="sd">        summaries: A `list` of dictionnaries.</span>
<span class="sd">        candidate_key: A string corresponding to the candidate summary in the dictionnaries.</span>
<span class="sd">        ref_key: A string corresponding to the reference summary in the dictionnaries.</span>
<span class="sd">    Returns:</span>
<span class="sd">        A dictionnary containing a list for each score</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scores</span> <span class="o">=</span>  <span class="p">{</span>
        <span class="s2">&quot;rouge-1&quot;</span> <span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
        <span class="s2">&quot;rouge-2&quot;</span> <span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
<span class="c1">#        &quot;rouge-3&quot; : list(),</span>
<span class="c1">#        &quot;rouge-4&quot; : list(),</span>
        <span class="s2">&quot;rouge-l&quot;</span> <span class="p">:</span> <span class="nb">list</span><span class="p">(),</span>
        <span class="s2">&quot;rouge-s&quot;</span> <span class="p">:</span> <span class="nb">list</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">index_d</span><span class="p">,</span> <span class="n">summaries</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summaries</span><span class="p">):</span>
        <span class="n">hypothesis</span> <span class="o">=</span> <span class="n">summaries</span><span class="p">[</span><span class="n">candidate_key</span><span class="p">]</span>
        <span class="n">abstract</span> <span class="o">=</span> <span class="n">summaries</span><span class="p">[</span><span class="n">ref_key</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;rouge-1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rouge_n</span><span class="p">(</span><span class="n">hypothesis</span><span class="p">,</span> <span class="n">abstract</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rouge 1 marche pas&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sum : &quot;</span><span class="p">,</span> <span class="n">hypothesis</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;abstract : &quot;</span><span class="p">,</span> <span class="n">abstract</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;rouge-2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rouge_n</span><span class="p">(</span><span class="n">hypothesis</span><span class="p">,</span> <span class="n">abstract</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rouge 2 marche pas&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sum : &quot;</span><span class="p">,</span> <span class="n">hypothesis</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;abstract : &quot;</span><span class="p">,</span> <span class="n">abstract</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;rouge-l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rouge_l</span><span class="p">(</span><span class="n">hypothesis</span><span class="p">,</span> <span class="n">abstract</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rouge L marche pas&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sum : &quot;</span><span class="p">,</span> <span class="n">hypothesis</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;abstract : &quot;</span><span class="p">,</span> <span class="n">abstract</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">scores</span><span class="p">[</span><span class="s2">&quot;rouge-s&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rouge_s</span><span class="p">(</span><span class="n">hypothesis</span><span class="p">,</span> <span class="n">abstract</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rouge S marche pas&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sum : &quot;</span><span class="p">,</span> <span class="n">hypothesis</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;abstract : &quot;</span><span class="p">,</span> <span class="n">abstract</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scores</span>


</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">GENSIM_SCORES</span> <span class="o">=</span> <span class="n">make_rouge_scores</span><span class="p">(</span><span class="n">SUMMARIES</span><span class="p">,</span> <span class="s2">&quot;gensim_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_sum&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">OUR_SCORES</span> <span class="o">=</span> <span class="n">make_rouge_scores</span><span class="p">(</span><span class="n">SUMMARIES</span><span class="p">,</span> <span class="s2">&quot;our_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_sum&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">make_cdf</span><span class="p">(</span><span class="n">gismo_scores</span> <span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">textrank_scores</span> <span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">score_name</span> <span class="p">:</span><span class="nb">str</span><span class="p">):</span>
    <span class="c1">#x_axes = [i for i in range(0, len(SUMMARIES))]</span>
    <span class="c1">#y_axes_1 = np.cumsum(sorted(gismo_scores))</span>
    <span class="c1">#y_axes_2 = np.cumsum(sorted(textrank_scores))</span>

    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">gismo_scores</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gismo_scores</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">gismo_scores</span><span class="p">)</span>
    <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">textrank_scores</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">textrank_scores</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">textrank_scores</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1">#plt.xlabel(&quot;Documents percentage&quot;, fontsize = &quot;x-large&quot;)</span>
    <span class="c1">#plt.ylabel(score_name, fontsize = &quot;x-large&quot;)</span>
    <span class="c1">#plt.title(&quot;Cumulative sum of &quot; + score_name + &quot; scores&quot;, fontsize = &quot;x-large&quot;)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Score&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Fonction de distribution cumulative&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">score_name</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gismo&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TextRank&quot;</span><span class="p">)</span>

    <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>
    <span class="n">tikzplotlib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;results/cosine_sim.tex&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="k">for</span> <span class="n">score_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;rouge-1&quot;</span><span class="p">]:</span><span class="c1">#, &quot;rouge-2&quot;, &quot;rouge-l&quot;, &quot;rouge-s&quot;]:</span>
    <span class="n">make_cdf</span><span class="p">(</span><span class="n">OUR_SCORES</span><span class="p">[</span><span class="n">score_name</span><span class="p">],</span> <span class="n">GENSIM_SCORES</span><span class="p">[</span><span class="n">score_name</span><span class="p">],</span> <span class="n">score_name</span><span class="p">)</span>
    <span class="c1">#cdf(OUR_SCORES[score_name], GENSIM_SCORES[score_name])</span>

<span class="c1">#def cdf(data, data2):</span>
<span class="c1">#    x, y = sorted(data), np.arange(len(data)) / len(data)</span>
<span class="c1">#    x2, y2 = sorted(data2), np.arange(len(data2)) / len(data2)</span>
<span class="c1">#    plt.plot(x, y)</span>
<span class="c1">#    plt.plot(x2, y2)</span>
<span class="c1">#cdf(GISMO_TIMES, TEXTRANK_TIMES)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_covid_summarizer_57_0.png" src="../_images/tutorials_covid_summarizer_57_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#get_abstract(DOCUMENTS[267])</span>
<span class="c1">#test = &#39;Oligonucleotide-directed mutagenesis was&#39;</span>
<span class="c1">#make_sentences(test)</span>
<span class="c1">#make_vocab(test)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">for</span> <span class="n">score_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;rouge-1&quot;</span><span class="p">,</span> <span class="s2">&quot;rouge-2&quot;</span><span class="p">,</span> <span class="s2">&quot;rouge-l&quot;</span><span class="p">,</span> <span class="s2">&quot;rouge-s&quot;</span><span class="p">]:</span>
    <span class="c1">#make_scores_plot(OUR_SCORES[score_name], GENSIM_SCORES[score_name], score_name)</span>
    <span class="c1">#make_diff_scores_plot(OUR_SCORES[score_name], GENSIM_SCORES[score_name], score_name, len(SUMMARIES))</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;moyenne </span><span class="si">%(score)s</span><span class="s2"> Gismo : </span><span class="si">%(ours)s</span><span class="s2">, moyenne </span><span class="si">%(score)s</span><span class="s2"> TextRank : </span><span class="si">%(gensims)s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">{</span>
            <span class="s2">&quot;score&quot;</span>   <span class="p">:</span> <span class="n">score_name</span><span class="p">,</span>
            <span class="s2">&quot;ours&quot;</span>    <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">OUR_SCORES</span><span class="p">[</span><span class="n">score_name</span><span class="p">]),</span>
            <span class="s2">&quot;gensims&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">GENSIM_SCORES</span><span class="p">[</span><span class="n">score_name</span><span class="p">])</span>
        <span class="p">}</span>
    <span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
moyenne rouge-1 Gismo : 0.4247599168029938, moyenne rouge-1 TextRank : 0.4130339159807649
moyenne rouge-2 Gismo : 0.17307307061462499, moyenne rouge-2 TextRank : 0.13015854235029245
moyenne rouge-l Gismo : 0.32950102231317296, moyenne rouge-l TextRank : 0.35863914448436035
moyenne rouge-s Gismo : 0.08983885061710079, moyenne rouge-s TextRank : 0.09771816400275737
</pre></div></div>
</div>
</div>
<div class="section" id="Comparing-cosine-similarities">
<h1>Comparing cosine similarities<a class="headerlink" href="#Comparing-cosine-similarities" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">summarizer.measures</span> <span class="kn">import</span> <span class="n">cosine_sim</span><span class="p">,</span> <span class="n">make_scores</span><span class="p">,</span> <span class="n">make_scores_plot</span><span class="p">,</span> <span class="n">make_diff_scores_plot</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">OUR_COS_SIM</span> <span class="o">=</span> <span class="n">make_scores</span><span class="p">(</span><span class="n">SUMMARIES</span><span class="p">,</span> <span class="s2">&quot;our_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_sum&quot;</span><span class="p">,</span> <span class="n">cosine_sim</span><span class="p">,</span> <span class="n">EMBEDDING</span><span class="p">)</span>
<span class="n">GENSIM_COS_SIM</span> <span class="o">=</span> <span class="n">make_scores</span><span class="p">(</span><span class="n">SUMMARIES</span><span class="p">,</span> <span class="s2">&quot;gensim_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_sum&quot;</span><span class="p">,</span> <span class="n">cosine_sim</span><span class="p">,</span> <span class="n">EMBEDDING</span><span class="p">)</span>
<span class="c1">#make_scores_plot(OUR_COS_SIM, GENSIM_COS_SIM, &quot;Cosine Similarity&quot;)</span>
<span class="c1">#make_diff_scores_plot(OUR_COS_SIM, GENSIM_COS_SIM, &quot;Cosine Similarity&quot;, len(SUMMARIES))</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;moyenne cosine similarity Gismo : </span><span class="si">%(ours)s</span><span class="s2">, moyenne cosine similarity TextRank : </span><span class="si">%(gensims)s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">{</span>
        <span class="s2">&quot;ours&quot;</span>    <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">OUR_COS_SIM</span><span class="p">),</span>
        <span class="s2">&quot;gensims&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">GENSIM_COS_SIM</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="c1">#CUMSUM</span>
<span class="c1">#x_axes = [i for i in range(0, len(SUMMARIES))]</span>
<span class="c1">##x_axes = [(100 / len(gismo_times)) * i for i in x_vect]</span>
<span class="c1">#y_axes_1 = np.cumsum(sorted(OUR_COS_SIM))</span>
<span class="c1">#y_axes_2 = np.cumsum(sorted(GENSIM_COS_SIM))</span>
<span class="c1">#</span>
<span class="c1">#fig = plt.figure(figsize=(10, 8))</span>
<span class="c1">#ax = fig.add_subplot(1, 1, 1)</span>
<span class="c1">#plt.xlabel(&quot;Documents percentage&quot;, fontsize = &quot;x-large&quot;)</span>
<span class="c1">#plt.ylabel(&quot;Cosine similarity&quot;, fontsize = &quot;x-large&quot;)</span>
<span class="c1">#plt.title(&quot;Cumulative sum of cosine similarity scores&quot;, fontsize = &quot;x-large&quot;)</span>
<span class="c1">#</span>
<span class="c1">#ax.plot(x_axes, y_axes_1, label=&quot;Gismo&quot;)</span>
<span class="c1">#ax.plot(x_axes, y_axes_2, label=&quot;TextRank&quot;)</span>
<span class="c1">#</span>
<span class="c1">#legend = ax.legend(loc = &quot;upper right&quot;, fontsize = &quot;x-large&quot;)</span>
<span class="c1">#plt.show()</span>

<span class="n">make_cdf</span><span class="p">(</span><span class="n">OUR_COS_SIM</span><span class="p">,</span> <span class="n">GENSIM_COS_SIM</span><span class="p">,</span> <span class="s2">&quot;Cosine Similarity&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
moyenne cosine similarity Gismo : 0.010903622409463331, moyenne cosine similarity TextRank : 0.011769514549838635
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_covid_summarizer_61_1.png" src="../_images/tutorials_covid_summarizer_61_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[138]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">summarizer.measures</span> <span class="kn">import</span> <span class="n">extended_jaccard</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">extended_jaccard</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[138]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1.0000000000000002
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[139]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">summarizer.measures</span> <span class="kn">import</span> <span class="n">make_scores</span><span class="p">,</span> <span class="n">make_scores_plot</span>

<span class="n">OUR_JAC_SIM</span> <span class="o">=</span> <span class="n">make_scores</span><span class="p">(</span><span class="n">SUMMARIES</span><span class="p">,</span> <span class="s2">&quot;our_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_sum&quot;</span><span class="p">,</span> <span class="n">extended_jaccard</span><span class="p">,</span> <span class="n">EMBEDDING</span><span class="p">)</span>
<span class="n">GENSIM_JAC_SIM</span> <span class="o">=</span> <span class="n">make_scores</span><span class="p">(</span><span class="n">SUMMARIES</span><span class="p">,</span> <span class="s2">&quot;gensim_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_sum&quot;</span><span class="p">,</span> <span class="n">extended_jaccard</span><span class="p">,</span> <span class="n">EMBEDDING</span><span class="p">)</span>
<span class="c1">#make_scores_plot(OUR_JAC_SIM, GENSIM_JAC_SIM, &quot;Extended Jaccard Similarity&quot;)</span>
<span class="c1">#make_diff_scores_plot(OUR_JAC_SIM, GENSIM_JAC_SIM, &quot;Extended Jaccard Similarity&quot;, len(SUMMARIES))</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;moyenne extended Jaccard similarity Gismo : </span><span class="si">%(ours)s</span><span class="s2">,</span><span class="se">\n\</span>
<span class="s2">     moyenne extended Jaccard similarity TextRank : </span><span class="si">%(gensims)s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">{</span>
        <span class="s2">&quot;ours&quot;</span>    <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">OUR_JAC_SIM</span><span class="p">),</span>
        <span class="s2">&quot;gensims&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">GENSIM_JAC_SIM</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1">##CUMSUM</span>
<span class="c1">#x_axes = [i for i in range(0, len(SUMMARIES))]</span>
<span class="c1">##x_axes = [(100 / len(gismo_times)) * i for i in x_vect]</span>
<span class="c1">#y_axes_1 = np.cumsum(sorted(OUR_JAC_SIM))</span>
<span class="c1">#y_axes_2 = np.cumsum(sorted(GENSIM_JAC_SIM))</span>
<span class="c1">#</span>
<span class="c1">#fig = plt.figure(figsize=(10, 8))</span>
<span class="c1">#ax = fig.add_subplot(1, 1, 1)</span>
<span class="c1">#plt.xlabel(&quot;Documents percentage&quot;, fontsize = &quot;x-large&quot;)</span>
<span class="c1">#plt.ylabel(&quot;Extended Jaccard similarity&quot;, fontsize = &quot;x-large&quot;)</span>
<span class="c1">#plt.title(&quot;Cumulative sum of extended jaccard scores&quot;, fontsize = &quot;x-large&quot;)</span>
<span class="c1">#</span>
<span class="c1">#ax.plot(x_axes, y_axes_1, label=&quot;Gismo&quot;)</span>
<span class="c1">#ax.plot(x_axes, y_axes_2, label=&quot;TextRank&quot;)</span>
<span class="c1">#</span>
<span class="c1">#legend = ax.legend(loc = &quot;upper right&quot;, fontsize = &quot;x-large&quot;)</span>
<span class="c1">#plt.show()</span>
<span class="n">make_cdf</span><span class="p">(</span><span class="n">OUR_JAC_SIM</span><span class="p">,</span> <span class="n">GENSIM_JAC_SIM</span><span class="p">,</span> <span class="s2">&quot;Extended Jaccard Similarity&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
moyenne extended Jaccard similarity Gismo : 0.24651472455644696,
     moyenne extended Jaccard similarity TextRank : 0.2513097175671632
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_covid_summarizer_64_1.png" src="../_images/tutorials_covid_summarizer_64_1.png" />
</div>
</div>
<p>This is not a metric, <span class="math notranslate nohighlight">\(D_{KL}(P, Q)\)</span> tells us how much <span class="math notranslate nohighlight">\(P\)</span> diverges from <span class="math notranslate nohighlight">\(Q\)</span>. Our distribution will have a lot of zeros, so computing the KL divergence between them requires a smoothing operation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[88]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">summarizer.measures</span> <span class="kn">import</span> <span class="n">div_kl</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">div_kl</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">div_kl</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
229.09022684922803
0.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[90]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">summarizer.measures</span> <span class="kn">import</span> <span class="n">div_kl</span><span class="p">,</span> <span class="n">make_scores</span><span class="p">,</span> <span class="n">make_scores_plot</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="n">OUR_DKL</span> <span class="o">=</span> <span class="n">make_scores</span><span class="p">(</span><span class="n">SUMMARIES</span><span class="p">,</span> <span class="s2">&quot;our_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_sum&quot;</span><span class="p">,</span>
                      <span class="n">partial</span><span class="p">(</span><span class="n">div_kl</span><span class="p">,</span> <span class="n">smallest_float</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">300</span><span class="p">)),</span> <span class="n">EMBEDDING</span><span class="p">)</span>
<span class="n">GENSIM_DKL</span> <span class="o">=</span> <span class="n">make_scores</span><span class="p">(</span><span class="n">SUMMARIES</span><span class="p">,</span> <span class="s2">&quot;gensim_sum&quot;</span><span class="p">,</span> <span class="s2">&quot;ref_sum&quot;</span><span class="p">,</span>
                      <span class="n">partial</span><span class="p">(</span><span class="n">div_kl</span><span class="p">,</span> <span class="n">smallest_float</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">300</span><span class="p">)),</span> <span class="n">EMBEDDING</span><span class="p">)</span>

<span class="c1">#make_scores_plot(OUR_DKL, GENSIM_DKL, &quot;Kullback-Leibler Divergence&quot;)</span>
<span class="c1">#make_diff_scores_plot(OUR_DKL, GENSIM_DKL, &quot;Kullback-Leibler Divergence&quot;, len(SUMMARIES))</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;moyenne KL divergence Gismo : </span><span class="si">%(ours)s</span><span class="s2">,</span><span class="se">\n\</span>
<span class="s2">     moyenne KL divergence TextRank : </span><span class="si">%(gensims)s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">{</span>
        <span class="s2">&quot;ours&quot;</span>    <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">OUR_DKL</span><span class="p">),</span>
        <span class="s2">&quot;gensims&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">GENSIM_DKL</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1">##CUMSUM</span>
<span class="c1">#x_axes = [i for i in range(0, len(SUMMARIES))]</span>
<span class="c1">##x_axes = [(100 / len(gismo_times)) * i for i in x_vect]</span>
<span class="c1">#y_axes_1 = np.cumsum(sorted(OUR_DKL))</span>
<span class="c1">#y_axes_2 = np.cumsum(sorted(GENSIM_DKL))</span>
<span class="c1">#</span>
<span class="c1">#fig = plt.figure(figsize=(10, 8))</span>
<span class="c1">#ax = fig.add_subplot(1, 1, 1)</span>
<span class="c1">#plt.xlabel(&quot;Documents percentage&quot;, fontsize = &quot;x-large&quot;)</span>
<span class="c1">#plt.ylabel(&quot;KL divergence&quot;, fontsize = &quot;x-large&quot;)</span>
<span class="c1">#plt.title(&quot;Cumulative sum of KL divergence scores&quot;, fontsize = &quot;x-large&quot;)</span>
<span class="c1">#</span>
<span class="c1">#ax.plot(x_axes, y_axes_1, label=&quot;Gismo&quot;)</span>
<span class="c1">#ax.plot(x_axes, y_axes_2, label=&quot;TextRank&quot;)</span>
<span class="c1">#</span>
<span class="c1">#legend = ax.legend(loc = &quot;upper right&quot;, fontsize = &quot;x-large&quot;)</span>
<span class="c1">#plt.show()</span>
<span class="n">make_cdf</span><span class="p">(</span><span class="n">OUR_DKL</span><span class="p">,</span> <span class="n">GENSIM_DKL</span><span class="p">,</span> <span class="s2">&quot;KL divergence&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
moyenne KL divergence Gismo : 412.04701731181376,
     moyenne KL divergence TextRank : 416.095110780232
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_covid_summarizer_67_1.png" src="../_images/tutorials_covid_summarizer_67_1.png" />
</div>
</div>
<p>If we choose to compote the divergence of <span class="math notranslate nohighlight">\(P\)</span> from <span class="math notranslate nohighlight">\(Q\)</span> on the support of <span class="math notranslate nohighlight">\(Q\)</span>, the results are the following : it doesn’t work anymore and sometimes gives negative values because the sum of V on the support of W is not 1 anymore</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[76]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span>

<span class="k">def</span> <span class="nf">div_kl_csr</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">W</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> <span class="c1"># On the support of W only</span>
    <span class="n">Vbis</span> <span class="o">=</span> <span class="n">V</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">Wbis</span> <span class="o">=</span> <span class="n">W</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">dok_matrix</span><span class="p">(</span><span class="n">Vbis</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">F</span><span class="p">[</span><span class="n">Wbis</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()]</span> <span class="o">=</span> <span class="n">Vbis</span><span class="p">[</span><span class="n">Wbis</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()]</span> <span class="o">/</span> <span class="n">Wbis</span><span class="p">[</span><span class="n">Wbis</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()]</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>
    <span class="n">F</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
    <span class="c1">#relative_entropy = scipy.special.rel_entr(V.todense()[0], W.todense()[0])</span>
    <span class="c1">#return np.sum(relative_entropy, axis = 1)</span>

<span class="n">V</span> <span class="o">=</span> <span class="n">EMBEDDING</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">getrow</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">W</span> <span class="o">=</span> <span class="n">EMBEDDING</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">getrow</span><span class="p">(</span><span class="mi">53</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">div_kl_csr</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">V</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">div_kl_csr</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">W</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">div_kl_csr</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">V</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-0.062040453286260996
0.4740018485633234
0.0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[77]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">summarizer.measures</span> <span class="kn">import</span> <span class="n">div_kl</span><span class="p">,</span> <span class="n">make_scores</span><span class="p">,</span> <span class="n">make_scores_plot</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="c1">#OUR_DKL = make_scores(SUMMARIES, &quot;our_sum&quot;, &quot;ref_sum&quot;,</span>
<span class="c1">#                      partial(div_kl, smallest_float = 10 ** (-300)), EMBEDDING)</span>
<span class="c1">#TEXTRANK_DKL = make_scores(SUMMARIES, &quot;textrank_sum&quot;, &quot;ref_sum&quot;,</span>
<span class="c1">#                      partial(div_kl, smallest_float = 10 ** (-300)), EMBEDDING)</span>

<span class="n">OUR_DKL</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">div_kl_csr</span><span class="p">(</span>
        <span class="p">(</span><span class="n">EMBEDDING</span><span class="o">.</span><span class="n">query_projection</span><span class="p">(</span><span class="n">summarie</span><span class="p">[</span><span class="s2">&quot;our_sum&quot;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">(</span><span class="n">EMBEDDING</span><span class="o">.</span><span class="n">query_projection</span><span class="p">(</span><span class="n">summarie</span><span class="p">[</span><span class="s2">&quot;ref_sum&quot;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">summarie</span> <span class="ow">in</span> <span class="n">SUMMARIES</span>
<span class="p">]</span>

<span class="n">TEXTRANK_DKL</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">div_kl_csr</span><span class="p">(</span>
        <span class="p">(</span><span class="n">EMBEDDING</span><span class="o">.</span><span class="n">query_projection</span><span class="p">(</span><span class="n">summarie</span><span class="p">[</span><span class="s2">&quot;gensim_sum&quot;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">(</span><span class="n">EMBEDDING</span><span class="o">.</span><span class="n">query_projection</span><span class="p">(</span><span class="n">summarie</span><span class="p">[</span><span class="s2">&quot;ref_sum&quot;</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">summarie</span> <span class="ow">in</span> <span class="n">SUMMARIES</span>
<span class="p">]</span>


<span class="n">make_scores_plot</span><span class="p">(</span><span class="n">OUR_DKL</span><span class="p">,</span> <span class="n">TEXTRANK_DKL</span><span class="p">,</span> <span class="s2">&quot;Kullback-Leibler Divergence&quot;</span><span class="p">)</span>
<span class="n">make_diff_scores_plot</span><span class="p">(</span><span class="n">OUR_DKL</span><span class="p">,</span> <span class="n">TEXTRANK_DKL</span><span class="p">,</span> <span class="s2">&quot;Kullback-Leibler Divergence&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">SUMMARIES</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;moyenne KL divergence Gismo : </span><span class="si">%(ours)s</span><span class="s2">,</span><span class="se">\n\</span>
<span class="s2">     moyenne KL divergence TextRank : </span><span class="si">%(textranks)s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">{</span>
        <span class="s2">&quot;ours&quot;</span>      <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">OUR_DKL</span><span class="p">),</span>
        <span class="s2">&quot;textranks&quot;</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">TEXTRANK_DKL</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_covid_summarizer_70_0.png" src="../_images/tutorials_covid_summarizer_70_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_covid_summarizer_70_1.png" src="../_images/tutorials_covid_summarizer_70_1.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
moyenne KL divergence Gismo : -0.00885629311709311,
     moyenne KL divergence TextRank : 0.010101046719767035
</pre></div></div>
</div>
</div>
<div class="section" id="Mesures-de-temps-en-multidoc">
<h1>Mesures de temps en multidoc<a class="headerlink" href="#Mesures-de-temps-en-multidoc" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">gensim.summarization.summarizer</span> <span class="k">as</span> <span class="nn">gen_sum</span>


<span class="n">RATIO</span> <span class="o">=</span> <span class="mf">0.04</span>

<span class="c1">#for i in range(25):</span>
<span class="c1">#    with open(f&quot;pickles/multidoc_{i}.txt&quot;, &quot;w&quot;) as f:</span>
<span class="c1">#        for doc in DOCUMENTS[1000 * i : max(1000 * (i+1), len(DOCUMENTS))]:</span>
<span class="c1">#            f.write(doc[&quot;content&quot;] + &quot; &quot;)</span>
<span class="c1">#</span>


<span class="c1">#i = 0</span>
<span class="c1">#with open(f&quot;pickles/multidoc_{i}.txt&quot;, &quot;r&quot;) as f:</span>
<span class="c1">#    document = f.read()</span>
<span class="c1">#textrank_start_time = time.clock()</span>
<span class="c1">#print(gen_sum.summarize(document, word_count = 300)\</span>
<span class="c1">#                                .replace(&quot;\n&quot;, &quot; &quot;).replace(&quot;\r&quot;,&quot; &quot;))#[:num_char]) ratio = RATIO / 100</span>
<span class="c1">#</span>
<span class="c1">#print(time.clock() - textrank_start_time)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">gensim.summarization.summarizer</span> <span class="k">as</span> <span class="nn">gen_sum</span>

<span class="n">mean_computation_time_gensim</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">TEXTRANK_TIMES</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">TEXTRANK_SUMMARIES</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">):</span>
    <span class="c1">#with open(f&quot;pickles/multidoc_{i}.txt&quot;, &quot;r&quot;) as f:</span>
    <span class="c1">#    document = f.read()</span>
    <span class="n">document</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">doc</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">DOCUMENTS</span><span class="p">[</span><span class="mi">100</span> <span class="o">*</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]])</span>
    <span class="n">textrank_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">TEXTRANK_SUMMARIES</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">gen_sum</span><span class="o">.</span><span class="n">summarize</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">word_count</span> <span class="o">=</span> <span class="mi">300</span><span class="p">)</span>\
                                        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">))</span><span class="c1">#[:num_char]) ratio = RATIO/100</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">TEXTRANK_SUMMARIES</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">TEXTRANK_TIMES</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">textrank_start_time</span><span class="p">)</span>
    <span class="n">mean_computation_time_gensim</span> <span class="o">+=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">textrank_start_time</span>
<span class="n">mean_computation_time_gensim</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">TEXTRANK_TIMES</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">TEXTRANK_TIMES</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gismo.common</span> <span class="kn">import</span> <span class="n">auto_k</span>

<span class="n">mean_computation_time_gismo</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">GISMO_TIMES</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="n">GISMO_SUMMARIES</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">):</span>
    <span class="n">num_sentences</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">make_sentences</span><span class="p">(</span><span class="n">TEXTRANK_SUMMARIES</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="n">real_start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
    <span class="n">GISMO_SUMMARIES</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="n">summarize</span><span class="p">(</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="n">DOCUMENTS</span><span class="p">[</span><span class="mi">100</span> <span class="o">*</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">num_sentences</span> <span class="o">=</span> <span class="n">num_sentences</span><span class="p">,</span>
            <span class="n">num_documents</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
            <span class="n">embedding</span> <span class="o">=</span> <span class="n">EMBEDDING</span><span class="p">,</span>
            <span class="n">weight_s</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="c1"># Vaut 1 si pas MMR</span>
            <span class="n">covering</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="c1"># ni MMR ni covering , on fait du glouton</span>
            <span class="n">sim_to_query</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">itf</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="c1">#query_distortion = False,</span>
            <span class="n">length_textrank</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">TEXTRANK_SUMMARIES</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
            <span class="n">post</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">size_generic_query</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
            <span class="c1">#size_generic_query = None,</span>
            <span class="c1">#target_auto_k = 3</span>
        <span class="p">))</span><span class="c1">#[:len(TEXTRANK_SUMMARIES[i])]</span>

    <span class="p">)</span>
    <span class="n">GISMO_TIMES</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">real_start_time</span><span class="p">)</span>
    <span class="n">mean_computation_time_gismo</span> <span class="o">+=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">real_start_time</span>
<span class="n">mean_computation_time_gismo</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">GISMO_TIMES</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean computation time of Gismo summarizer : </span><span class="si">%s</span><span class="s2"> seconds&quot;</span> <span class="o">%</span> <span class="n">mean_computation_time_gismo</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean computation time of TextRank summarizer : </span><span class="si">%s</span><span class="s2"> seconds&quot;</span> <span class="o">%</span> <span class="n">mean_computation_time_gensim</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Gismo based summarizer is </span><span class="si">%s</span><span class="s2"> times faster than TextRank summarizer&quot;</span> <span class="o">%</span> \
      <span class="p">(</span><span class="n">mean_computation_time_gensim</span> <span class="o">/</span> <span class="n">mean_computation_time_gismo</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">SUMMARIES</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="c1"># To compute our summaries</span>
<span class="n">cpt</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">):</span>
    <span class="n">abstract</span> <span class="o">=</span> <span class="n">DOCUMENTS</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;abstract&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">GISMO_SUMMARIES</span><span class="p">[</span><span class="n">cpt</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">TEXTRANK_SUMMARIES</span><span class="p">[</span><span class="n">cpt</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">SUMMARIES</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;ref_sum&quot;</span> <span class="p">:</span> <span class="n">abstract</span><span class="p">,</span>
                <span class="s2">&quot;our_sum&quot;</span> <span class="p">:</span> <span class="n">GISMO_SUMMARIES</span><span class="p">[</span><span class="n">cpt</span><span class="p">],</span>
                <span class="s2">&quot;gensim_sum&quot;</span> <span class="p">:</span> <span class="n">TEXTRANK_SUMMARIES</span><span class="p">[</span><span class="n">cpt</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="n">cpt</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SUMMARIES</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
25
</pre></div></div>
</div>
</div>
<div class="section" id="id1">
<h1>Execution time comparision<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">def</span> <span class="nf">make_times_plot</span><span class="p">(</span><span class="n">gismo_times</span> <span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">textrank_times</span> <span class="p">:</span><span class="nb">list</span><span class="p">):</span>
    <span class="n">x_vect</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">gismo_times</span><span class="p">))]</span>
    <span class="n">x_axes</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">100</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">gismo_times</span><span class="p">))</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x_vect</span><span class="p">]</span>
    <span class="n">y_axes_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">gismo_times</span><span class="p">)</span>
    <span class="n">y_axes_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">textrank_times</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Documents&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Logs des temps d&#39;exécution en secondes&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Log des sommes cumulées des temps d&#39;exécution&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">x_axes</span><span class="p">,</span> <span class="n">y_axes_1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gismo&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">semilogy</span><span class="p">(</span><span class="n">x_axes</span><span class="p">,</span> <span class="n">y_axes_2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TextRank&quot;</span><span class="p">)</span>

    <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>
    <span class="n">tikzplotlib</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;rapport/courbes/tikzplotlib/multi_doc_times.tex&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">make_times_plot</span><span class="p">(</span><span class="n">GISMO_TIMES</span><span class="p">,</span> <span class="n">TEXTRANK_TIMES</span><span class="p">)</span>


</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_covid_summarizer_79_0.png" src="../_images/tutorials_covid_summarizer_79_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Taking-a-look-at-summaries">
<h1>Taking a look at summaries<a class="headerlink" href="#Taking-a-look-at-summaries" title="Permalink to this headline">¶</a></h1>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[115]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Summary generated with Gsimo :&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">GISMO_SUMMARIES</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===========================================================================&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Summary generated with TextRank :&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TEXTRANK_SUMMARIES</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Summary generated with Gsimo :
The entire genome of IBV contains a positive-stranded ssRNA of 27 608 nucleotides, which encodes eight structural proteins and a set of nonstructural proteins that are crucial for viral RNA replication. IBV encodes 15 nonstructural proteins (nsp2-nsp16) which play crucial roles in RNA transcription and genome replication. Nonstructural protein 9 (nsp9) has been identified as a protein that is essential to viral replication because of its single-stranded RNAbinding ability.
===========================================================================
Summary generated with TextRank :
The crystal structure of SARS-CoV (group 2) nsp9 revealed that the protein exists as a dimer and functions as a single-stranded RNA-binding protein (Egloff et al., 2004; Sutton et al., 2004) . Initial crystals of IBV nsp9 were observed in condition No. 15 of Hampton Research Crystal Screen, which contained 0.2 M ammonium sulfate, 0.1 M sodium cacodylate trihydrate pH 6.5, 30%(w/v) polyethylene glycol 8000.
</pre></div></div>
</div>
<p>What could be used for more complete set of measures : <a class="reference external" href="https://github.com.cnpmjs.org/Maluuba/nlg-eval">nlgeval</a></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#from nlgeval import compute_metrics</span>

<span class="c1">#hypothesis = []</span>
<span class="c1">#references = []</span>
<span class="c1">#for document in DOCUMENTS:</span>
<span class="c1">#        abstract = get_abstract(document)</span>
<span class="c1">#        if abstract != &quot;&quot;:</span>
<span class="c1">#            # In order to compare two summaries of the same length</span>
<span class="c1">#            num_sentences = abstract.count(&quot;.&quot;)</span>
<span class="c1">#            #assert num_sentences == len(make_abstract_sentences(make_abstract_doc(document)))</span>
<span class="c1">#            hypothesis.append(abstract)</span>
<span class="c1">#            # Empty query to match the abstract that&#39;s a generic summary</span>
<span class="c1">#            references.append(&quot; &quot;.join(summarize_single_doc(document, &quot;&quot;, num_sentences)))</span>

<span class="c1">#metrics_dict = compute_metrics(hypothesis = hypothesis[0],</span>
<span class="c1">#                               references = references[0]</span>
<span class="c1">#                              )</span>
</pre></div>
</div>
</div>
<div class="section" id="Dynamic-summarizer">
<h2>Dynamic summarizer<a class="headerlink" href="#Dynamic-summarizer" title="Permalink to this headline">¶</a></h2>
<p>We want to be able to generate a new query (or queries) from each sentence of the summary first generated. The “user” could expand each sentence of the summary to get details on them. Each sentence of the sub-summaries could be extended in the same way and so on.</p>
<div class="section" id="Building-a-recursive-summary">
<h3>Building a recursive summary<a class="headerlink" href="#Building-a-recursive-summary" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">summarizer.building_summary</span> <span class="kn">import</span> <span class="n">make_tree</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">summarizer.simplified_documents</span> <span class="kn">import</span> <span class="n">get_abstract</span>
<span class="c1"># To get the time : time.clock()</span>

<span class="n">rand_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">DOCUMENTS</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">rand_indexes</span><span class="p">)</span>

<span class="n">DOC_LIST</span> <span class="o">=</span> <span class="p">[</span><span class="n">DOCUMENTS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rand_indexes</span><span class="p">]</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([6312, 4069, 1283, 5145, 2922, 2738,  501, 3413, 3039,  470, 5795,
       1830, 5504, 1553, 3101, 4159, 6417, 5557, 6544,  518, 5920, 3001,
       5840, 4888,   24, 5100, 1370, 4304, 5394, 6414, 3911, 3463, 4274,
        142, 3630, 2961,  767, 3065, 2369, 2733, 3181, 1364, 2904, 3762,
       3600, 2929, 1572, 4501, 3065, 3953, 2428, 5893,  797, 1689, 3600,
        675, 6337, 4738, 1331, 3839, 1628, 5368,  713, 4249, 5598, 1589,
       6026,  821, 4106, 1412, 6501,   99,  576, 2513, 2670,  663, 1181,
       1862, 6641, 2992,  741, 1366,  290, 3554,  806, 4151, 3105, 5955,
       4297, 4954, 4725,  725,  745, 6694, 6307, 1382,  648, 4985,  322,
       1820])
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">summarizer.visualizer</span> <span class="kn">import</span> <span class="p">(</span><span class="n">boldize</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">make_css</span><span class="p">,</span> <span class="n">make_html</span><span class="p">)</span> <span class="c1"># imports ds l&#39;ordre alphabetique</span>
<span class="kn">from</span> <span class="nn">summarizer.visualizer</span> <span class="kn">import</span> <span class="n">FormatKeywords</span>
<span class="k">def</span> <span class="nf">make_html</span><span class="p">(</span><span class="n">node</span> <span class="p">:</span><span class="nb">dict</span><span class="p">,</span> <span class="n">pairs</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">format_text</span><span class="p">(</span><span class="n">text</span> <span class="p">:</span><span class="nb">str</span><span class="p">):</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">node_to_keywords</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
            <span class="n">keywords</span> <span class="o">=</span> <span class="n">node_to_keywords</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">format_keywords</span> <span class="o">=</span> <span class="n">FormatKeywords</span><span class="p">(</span><span class="n">keywords</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">format_keywords</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">text</span>

    <span class="n">text</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
    <span class="k">return</span> \
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &lt;details&gt;</span>
<span class="sd">          &lt;summary&gt;%(text)s&lt;/summary&gt;</span>
<span class="sd">          &lt;div class=&quot;children&quot;&gt;</span>
<span class="sd">              %(children)s</span>
<span class="sd">          &lt;/div&gt;</span>
<span class="sd">        &lt;/details&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">{</span>
            <span class="s2">&quot;text&quot;</span>     <span class="p">:</span> <span class="p">(</span>
                <span class="s2">&quot;&quot;</span>   <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span>  <span class="k">else</span>
                <span class="n">text</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">pairs</span> <span class="k">else</span>
                <span class="n">format_text</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="s2">&quot;children&quot;</span> <span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="n">make_html</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">pairs</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;children&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">())</span>
            <span class="p">]),</span>
            <span class="s2">&quot;url&quot;</span> <span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;url&quot;</span><span class="p">)</span>
        <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">make_tree</span><span class="p">(</span>
    <span class="n">documents</span> <span class="p">:</span><span class="nb">list</span><span class="p">,</span>
    <span class="n">query</span> <span class="p">:</span><span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">depth</span> <span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">trees</span> <span class="p">:</span><span class="nb">list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(),</span>
    <span class="n">num_documents</span> <span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">num_sentences</span> <span class="p">:</span><span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">embedding</span> <span class="p">:</span><span class="n">Embedding</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">used_sentences</span> <span class="p">:</span><span class="nb">set</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds a hierarchical summary.</span>
<span class="sd">   Args:</span>
<span class="sd">        documents: A list of dict corresponding to documents, only the values of the &quot;content&quot; key will be summarized.</span>
<span class="sd">        query: A string.</span>
<span class="sd">        depth: An int giving the depth of the summary (depth one is a sequential summary).</span>
<span class="sd">        trees: A list of dict being completed, necessary for the recursivity.</span>
<span class="sd">        num_documents: An int corresponding to the number of top documents to be taking into account for the summary.</span>
<span class="sd">        num_sentences: An int corresponding of the number of sentences wanted in the summary.</span>
<span class="sd">        embedding: An Embedding fitted on a bigger corpus than documents.</span>
<span class="sd">        used_sentences: A set of &quot;forbidden&quot; sentences.</span>
<span class="sd">    Returns:</span>
<span class="sd">        A list of dict corresponding to the hierarchical summary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">depth</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">trees</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">used_sentences</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">used_sentences</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="p">(</span><span class="n">children</span><span class="p">,</span> <span class="n">keywords</span><span class="p">)</span> <span class="o">=</span> <span class="n">summarize</span><span class="p">(</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="n">documents</span><span class="p">,</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="p">,</span>
            <span class="n">num_documents</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
            <span class="n">num_sentences</span> <span class="o">=</span> <span class="n">num_sentences</span><span class="p">,</span>
            <span class="n">embedding</span> <span class="o">=</span> <span class="n">embedding</span><span class="p">,</span>
            <span class="n">is_documents_embedding</span><span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">used_sentences</span> <span class="o">=</span> <span class="n">used_sentences</span><span class="p">,</span>
            <span class="n">weight_s</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">itf</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="p">)</span>
        <span class="n">used_sentences</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[{</span>
            <span class="s2">&quot;text&quot;</span> <span class="p">:</span> <span class="n">child</span><span class="p">,</span>
            <span class="s2">&quot;current_keywords&quot;</span> <span class="p">:</span> <span class="n">keywords</span><span class="p">,</span>
            <span class="s2">&quot;children&quot;</span> <span class="p">:</span> <span class="n">make_tree</span><span class="p">(</span>
                <span class="n">trees</span> <span class="o">=</span> <span class="n">trees</span><span class="p">,</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">documents</span> <span class="o">=</span> <span class="n">documents</span><span class="p">,</span>
                <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">query</span><span class="p">,</span> <span class="n">child</span><span class="p">]),</span>
                <span class="n">num_sentences</span> <span class="o">=</span> <span class="n">num_sentences</span><span class="p">,</span>
                <span class="n">embedding</span> <span class="o">=</span> <span class="n">embedding</span><span class="p">,</span>
                <span class="n">used_sentences</span> <span class="o">=</span> <span class="n">used_sentences</span>
            <span class="p">)</span>
        <span class="p">}</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">]</span>



<span class="n">test</span> <span class="o">=</span> <span class="n">make_tree</span><span class="p">(</span>
    <span class="n">documents</span> <span class="o">=</span> <span class="n">DOCUMENTS</span><span class="p">,</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;vaccine&quot;</span><span class="p">,</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">num_documents</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">num_sentences</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">embedding</span> <span class="o">=</span> <span class="n">EMBEDDING</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">html</span><span class="p">(</span><span class="n">make_css</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">background</span> <span class="o">=</span> <span class="s2">&quot;#9edcf7&quot;</span><span class="p">))</span>
<span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">test</span><span class="p">:</span>
    <span class="n">html</span><span class="p">(</span>
        <span class="n">make_html</span><span class="p">(</span>
            <span class="n">tree</span><span class="p">,</span>
            <span class="p">[(</span>
                <span class="c1"># Pair of functions</span>
                <span class="k">lambda</span> <span class="n">node</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_keywords&quot;</span><span class="p">),</span>
                <span class="n">boldize</span>
            <span class="p">)]</span>
        <span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-14-06b4f5f5ca1b&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>html<span class="ansi-blue-fg">(</span>make_css<span class="ansi-blue-fg">(</span>color <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">&#34;black&#34;</span><span class="ansi-blue-fg">,</span> background <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">&#34;#9edcf7&#34;</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> <span class="ansi-green-fg">for</span> tree <span class="ansi-green-fg">in</span> test<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span>     html(
<span class="ansi-green-intense-fg ansi-bold">      4</span>         make_html(
<span class="ansi-green-intense-fg ansi-bold">      5</span>             tree<span class="ansi-blue-fg">,</span>

<span class="ansi-red-fg">NameError</span>: name &#39;html&#39; is not defined
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">GISMO_TIMES_DEPTH</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;depth 1&quot;</span> <span class="p">:</span> <span class="nb">list</span><span class="p">(),</span> <span class="s2">&quot;depth 2&quot;</span> <span class="p">:</span> <span class="nb">list</span><span class="p">(),</span> <span class="s2">&quot;depth 3&quot;</span> <span class="p">:</span> <span class="nb">list</span><span class="p">()}</span>
<span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">DOC_LIST</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">depth</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span>
        <span class="n">test</span> <span class="o">=</span> <span class="n">make_tree</span><span class="p">(</span>
            <span class="n">trees</span> <span class="o">=</span> <span class="p">[],</span>
            <span class="n">depth</span> <span class="o">=</span> <span class="n">depth</span><span class="p">,</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="p">[</span><span class="n">document</span><span class="p">],</span>
            <span class="n">num_sentences</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">embedding</span> <span class="o">=</span> <span class="n">EMBEDDING</span>
        <span class="p">)</span>
        <span class="n">GISMO_TIMES_DEPTH</span><span class="p">[</span><span class="s2">&quot;depth </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">depth</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">clock</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[88]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">x_vect</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">TEXTRANK_TIMES</span><span class="p">))]</span>
<span class="n">x_axes</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">100</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">TEXTRANK_TIMES</span><span class="p">))</span> <span class="o">*</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x_vect</span><span class="p">]</span>

<span class="n">TEXTRANK_TIMES</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">GISMO_TIMES_DEPTH</span><span class="p">[</span><span class="s2">&quot;depth 1&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">GISMO_TIMES_DEPTH</span><span class="p">[</span><span class="s2">&quot;depth 2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">GISMO_TIMES_DEPTH</span><span class="p">[</span><span class="s2">&quot;depth 3&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="n">y_axes_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">TEXTRANK_TIMES</span><span class="p">)</span>
<span class="n">y_axes_d1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">GISMO_TIMES_DEPTH</span><span class="p">[</span><span class="s2">&quot;depth 1&quot;</span><span class="p">])</span>
<span class="n">y_axes_d2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">GISMO_TIMES_DEPTH</span><span class="p">[</span><span class="s2">&quot;depth 2&quot;</span><span class="p">])</span>
<span class="n">y_axes_d3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">GISMO_TIMES_DEPTH</span><span class="p">[</span><span class="s2">&quot;depth 3&quot;</span><span class="p">])</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Documents percentage&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Execution time in seconds&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Cumulative sum of execution times per summary&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axes</span><span class="p">,</span> <span class="n">y_axes_1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;TextRank summary (depth 1)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axes</span><span class="p">,</span> <span class="n">y_axes_d1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hierarchical summary with depth 1&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axes</span><span class="p">,</span> <span class="n">y_axes_d2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hierarchical summary with depth 2&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_axes</span><span class="p">,</span> <span class="n">y_axes_d3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hierarchical summary with depth 3&quot;</span><span class="p">)</span>

<span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span> <span class="o">=</span> <span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="s2">&quot;x-large&quot;</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;results/time/execution_wrt_depth.svg&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_covid_summarizer_93_0.png" src="../_images/tutorials_covid_summarizer_93_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Mélanie Cambus, Marc-Olivier Buob, Fabien Mathieu.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>